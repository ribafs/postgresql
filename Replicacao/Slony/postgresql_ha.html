<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html dir="ltr" xmlns="http://www.w3.org/1999/xhtml" lang="pt-br"><head profile="http://gmpg.org/xfn/11">


	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title> EEEEEE Jão!!!</title>

	<link rel="stylesheet" href="postgresql_ha_arquivos/style.css" type="text/css" media="screen">
	<link rel="stylesheet" href="postgresql_ha_arquivos/orange.css" type="text/css" media="screen">
	<link rel="pingback" href="http://joaocosme.wordpress.com/xmlrpc.php">

	<link rel="alternate" type="application/rss+xml" title="Feed de EEEEEE Jão!!! »" href="http://joaocosme.wordpress.com/feed/">
<link rel="alternate" type="application/rss+xml" title="EEEEEE Jão!!! »  Feed de comentários" href="http://joaocosme.wordpress.com/comments/feed/">
<script type="text/javascript">
/* <![CDATA[ */
function addLoadEvent(func){var oldonload=window.onload;if(typeof window.onload!='function'){window.onload=func;}else{window.onload=function(){oldonload();func();}}}
/* ]]> */
</script>
<link rel="stylesheet" href="postgresql_ha_arquivos/global.css" type="text/css">
<script type="text/javascript" src="postgresql_ha_arquivos/l10n.js"></script>
<script type="text/javascript" src="postgresql_ha_arquivos/jquery.js"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://joaocosme.wordpress.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://joaocosme.wordpress.com/wp-includes/wlwmanifest.xml"> 
<link rel="index" title="EEEEEE Jão!!!" href="http://joaocosme.wordpress.com/">
<meta name="generator" content="WordPress.com">
<link rel="shortlink" href="http://wp.me/gCDF">
<link rel="shortcut icon" type="image/x-icon" href="http://1.gravatar.com/blavatar/bff62c43070b2f83f87342b7d07d9077?s=16" sizes="16x16">
<link rel="icon" type="image/x-icon" href="http://1.gravatar.com/blavatar/bff62c43070b2f83f87342b7d07d9077?s=16" sizes="16x16">
<link rel="apple-touch-icon" href="http://1.gravatar.com/blavatar/1b5551b5cda379453923fe4828a78ca3?s=158">
	<style type="text/css">
	/* <![CDATA[ */
				div#likes { margin-top: 15px; }
		.like-button { border: 1px solid #eee; padding: 2px 6px; font-size: 13px; font-family: arial, tahoma, sans-serif; }
		#wpl-likebox { clear: left; font-size: 11px; font-family: arial, tahoma, verdana, sans-serif !important; min-height: 30px; margin: 10px 0 !important; padding: 5px 0 10px 0 !important; }
		#wpl-button { float: left; background: url( http://s2.wp.com/i/buttonbg.png ) top left repeat-x; margin-right: 7px; border: 1px solid #d4d4d4; -moz-border-radius: 3px; -webkit-border-radius: 3px; border-radius: 3px; }
		#wpl-button a { color: #666 !important; line-height: 130% !important; text-decoration: none !important; outline: none; float: left; padding: 3px 6px 2px 24px !important; font-size: 11px !important; background: url( http://s1.wp.com/i/likestar.png ) 6px 49.8% no-repeat; }
		#wpl-button.liked { background: #feffce; border: 1px solid #f3e389; }
		#wpl-button.liked a { color: #ba871b !important; }
		#wpl-likebox #wpl-count { min-height: 25px; line-height: 130% !important; float: left; padding-top: 4px; }
		#wpl-likebox #wpl-avatars { clear: left; max-height: 98px; overflow: hidden; margin-top: 15px; line-height: 130% !important; }
		#wpl-likebox #wpl-avatars img { border: none !important; }
		#wpl-likebox #wpl-mustlogin { line-height: 14px !important; font-size: 11px; clear: left; margin-top: 5px; background: #f0f0f0; padding: 10px; width: 65%; -moz-border-radius: 3px; -webkit-border-radius: 3px; border-radius: 3px; }
		#wpl-likebox #wpl-mustlogin a { color: #888; text-decoration: underline; }
		#wpl-likebox #wpl-mustlogin p { margin: 5px 0; padding: 0 }
		#wpl-likebox #wpl-mustlogin input.input { padding: 2px; background: #fff; font-size: 11px; font-family: inherit; border: 1px solid #ccc; -moz-box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.1) inset; -webkit-box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.1) inset; line-height: 12px; }
		#wpl-likebox #wpl-mustlogin input#wp-submit { border: 1px solid #ccc; font-size: 11px; background: #fafafa; repeat-x; -moz-border-radius: 3px; -webkit-border-radius: 3px; border-radius: 3px; padding: 2px 4px !important; line-height: 12px; }
		#wpl-likebox #wpl-mustlogin label { position: relative; cursor: text; }
		#wpl-likebox #wpl-mustlogin label span { position: absolute; top: 0px; left: 5px; padding: 0 !important; }
		#wpl-likebox #wpl-mustlogin label span { top /*\**/: -10px\9; }
	/* ]]> */
	</style>
	<link rel="openid.server" href="http://joaocosme.wordpress.com/?openidserver=1">
<link rel="openid.delegate" href="http://joaocosme.wordpress.com/">
<link rel="search" type="application/opensearchdescription+xml" href="http://joaocosme.wordpress.com/osd.xml" title="EEEEEE Jão!!!">
<link rel="search" type="application/opensearchdescription+xml" href="http://wordpress.com/opensearch.xml" title="WordPress.com">
	<script type="text/javascript" charset="utf-8">
		try{
			var id = location.hash.match( /\#\!\/entry\/(\d+)/ )[1];
			if ( id ) {
				window.location = "http://joaocosme.wordpress.com?p=" + id;
			};
		}catch( error ){
		}
	</script>		
<meta name="application-name" content="EEEEEE Jão!!!"><meta name="msapplication-window" content="width=device-width;height=device-height"><meta name="msapplication-tooltip" content="#!/bin/bash aventuras de um Nerd disfarçado de bombado..."><meta name="msapplication-task" content="name=Subscrever;action-uri=http://joaocosme.wordpress.com/feed/;icon-uri=http://1.gravatar.com/blavatar/bff62c43070b2f83f87342b7d07d9077?s=16"><meta name="msapplication-task" content="name=Sign up for a free blog;action-uri=http://wordpress.com/signup/;icon-uri=http://s2.wp.com/i/favicon.ico"><meta name="msapplication-task" content="name=Suporte WordPress.com;action-uri=http://support.wordpress.com/;icon-uri=http://s2.wp.com/i/favicon.ico"><meta name="msapplication-task" content="name=Fóruns WordPress.com;action-uri=http://forums.wordpress.com/;icon-uri=http://s2.wp.com/i/favicon.ico">
<link rel="stylesheet" type="text/css" id="gravatar-card-css" href="postgresql_ha_arquivos/hovercard.css"><link rel="stylesheet" type="text/css" id="gravatar-card-services-css" href="postgresql_ha_arquivos/services.css"></head><body>

<div id="container">
	<div id="sitename">
		<h1><a href="http://joaocosme.wordpress.com/">EEEEEE Jão!!!</a></h1>
		<h2>#!/bin/bash aventuras de um Nerd disfarçado de bombado…</h2>
	</div>

	<div id="mainmenu">
			<ul class="level1">
		<li class="current_page_item"><a href="http://joaocosme.wordpress.com/">Início</a></li>
		<li class="page_item page-item-2"><a href="http://joaocosme.wordpress.com/about/" title="Sobre!!">Sobre!!</a></li>
	</ul>
	</div>

<div id="wrap">
<div id="leftside">

	<ul>

<li id="categories-153663432" class="widget widget_categories"><h2 class="widgettitle">Categorias</h2>
		<ul>
			<li class="cat-item cat-item-4827"><a href="http://joaocosme.wordpress.com/category/banco-de-dados/" title="Ver todos os posts arquivados em Banco de dados">Banco de dados</a> (2)
</li>
	<li class="cat-item cat-item-463"><a href="http://joaocosme.wordpress.com/category/geral/" title="Só viagem do dia mesmo!">geral</a> (3)
</li>
	<li class="cat-item cat-item-610"><a href="http://joaocosme.wordpress.com/category/linux/" title="Ver todos os posts arquivados em Linux">Linux</a> (3)
</li>
	<li class="cat-item cat-item-15989"><a href="http://joaocosme.wordpress.com/category/postgresql/" title="Ver todos os posts arquivados em Postgresql">Postgresql</a> (8)
</li>
	<li class="cat-item cat-item-1"><a href="http://joaocosme.wordpress.com/category/uncategorized/" title="Ver todos os posts arquivados em Uncategorized">Uncategorized</a> (5)
</li>
		</ul>
</li>
		<li id="recent-posts-2" class="widget widget_recent_entries">		<h2 class="widgettitle">Tópicos recentes</h2>
		<ul>
				<li><a href="http://joaocosme.wordpress.com/2010/04/07/pensamentos-07042010/" title="Pensamentos…&nbsp;07/04/2010">Pensamentos…&nbsp;07/04/2010</a></li>
				<li><a href="http://joaocosme.wordpress.com/2009/10/30/ha-em-postgresql-warm-stand-by-heartbeat-hapm/" title="HA em Postgresql = Warm Stand By + HeartBeat +&nbsp;HAPM">HA em Postgresql = Warm Stand By + HeartBeat +&nbsp;HAPM</a></li>
				<li><a href="http://joaocosme.wordpress.com/2009/09/10/a-journey-of-a-thousand-miles-must-begin-with-a-single-step/" title="A journey of a thousand miles must begin with a single&nbsp;step….">A journey of a thousand miles must begin with a single&nbsp;step….</a></li>
				<li><a href="http://joaocosme.wordpress.com/2009/08/10/flag-seen-problem-cyrus-all-messages-unread/" title="FLAG SEEN PROBLEM + CYRUS + ALL Messages&nbsp;Unread!">FLAG SEEN PROBLEM + CYRUS + ALL Messages&nbsp;Unread!</a></li>
				<li><a href="http://joaocosme.wordpress.com/2009/07/27/apache-load-balance-lenny/" title="Apache + Load Balance +&nbsp;Lenny">Apache + Load Balance +&nbsp;Lenny</a></li>
				</ul>
		</li>
<li id="archives-2" class="widget widget_archive"><h2 class="widgettitle">Arquivos</h2>
		<ul>
			<li><a href="http://joaocosme.wordpress.com/2010/04/" title="abril 2010">abril 2010</a></li>
	<li><a href="http://joaocosme.wordpress.com/2009/10/" title="outubro 2009">outubro 2009</a></li>
	<li><a href="http://joaocosme.wordpress.com/2009/09/" title="setembro 2009">setembro 2009</a></li>
	<li><a href="http://joaocosme.wordpress.com/2009/08/" title="agosto 2009">agosto 2009</a></li>
	<li><a href="http://joaocosme.wordpress.com/2009/07/" title="julho 2009">julho 2009</a></li>
	<li><a href="http://joaocosme.wordpress.com/2009/04/" title="abril 2009">abril 2009</a></li>
	<li><a href="http://joaocosme.wordpress.com/2009/03/" title="março 2009">março 2009</a></li>
	<li><a href="http://joaocosme.wordpress.com/2009/02/" title="fevereiro 2009">fevereiro 2009</a></li>
	<li><a href="http://joaocosme.wordpress.com/2008/09/" title="setembro 2008">setembro 2008</a></li>
	<li><a href="http://joaocosme.wordpress.com/2008/07/" title="julho 2008">julho 2008</a></li>
	<li><a href="http://joaocosme.wordpress.com/2008/06/" title="junho 2008">junho 2008</a></li>
		</ul>
</li>
<li id="calendar-2" class="widget widget_calendar"><h2 class="widgettitle">&nbsp;</h2>
<div id="calendar_wrap"><table id="wp-calendar" summary="Calendário">
	<caption>abril 2011</caption>
	<thead>
	<tr>
		<th scope="col" title="segunda-feira">S</th>
		<th scope="col" title="terça-feira">T</th>
		<th scope="col" title="quarta-feira">Q</th>
		<th scope="col" title="quinta-feira">Q</th>
		<th scope="col" title="sexta-feira">S</th>
		<th scope="col" title="sábado">S</th>
		<th scope="col" title="domingo">D</th>
	</tr>
	</thead>

	<tfoot>
	<tr>
		<td colspan="3" id="prev"><a href="http://joaocosme.wordpress.com/2010/04/" title="Ver posts de abril 2010">« abr</a></td>
		<td class="pad">&nbsp;</td>
		<td colspan="3" id="next" class="pad">&nbsp;</td>
	</tr>
	</tfoot>

	<tbody>
	<tr>
		<td colspan="4" class="pad">&nbsp;</td><td>1</td><td>2</td><td>3</td>
	</tr>
	<tr>
		<td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>10</td>
	</tr>
	<tr>
		<td>11</td><td>12</td><td>13</td><td>14</td><td>15</td><td>16</td><td>17</td>
	</tr>
	<tr>
		<td>18</td><td>19</td><td>20</td><td>21</td><td>22</td><td>23</td><td>24</td>
	</tr>
	<tr>
		<td>25</td><td>26</td><td>27</td><td>28</td><td id="today">29</td><td>30</td>
		<td class="pad" colspan="1">&nbsp;</td>
	</tr>
	</tbody>
	</table></div></li>
<li id="wp_tag_cloud" class="widget wp_widget_tag_cloud"><h2 class="widgettitle">Tags</h2>
<div style="overflow: hidden;"><a href="http://joaocosme.wordpress.com/tag/bash/" class="tag-link-2674" title="1 tópico" style="font-size: 8pt;">bash</a>
<a href="http://joaocosme.wordpress.com/tag/postgresql/" class="tag-link-15989" title="1 tópico" style="font-size: 8pt;">Postgresql</a></div></li>
	</ul>
</div>
<!-- Right Sidebar Template -->
<div id="rightside">
	<ul>
	
		<li><form method="get" id="searchform" action="http://joaocosme.wordpress.com/">
<div><input id="searchbox" name="s" type="text">
<input id="searchbutton" value="Pesquisar" type="submit">
</div>
</form>
</li>
</ul>
<ul>
 </ul>
<ul>
 <li><h2>Meta</h2>
  <ul>
   <li><a href="http://joaocosme.wordpress.com/wp-login.php?action=register">Registrar-se</a></li>   <li><a href="http://joaocosme.wordpress.com/wp-login.php">Login</a></li>
     </ul>
 </li>
</ul>
<ul>
 <li><h2>Subscrever</h2>
  <ul>
   <li class="feed"><a href="http://joaocosme.wordpress.com/feed/">Entradas (RSS)</a></li>
   <li class="feed"><a href="http://joaocosme.wordpress.com/comments/feed/">Comentários (RSS)</a></li>
  </ul>
 </li>
</ul>
</div>

<div id="content">
		
		<div class="post-192 post type-post status-publish format-standard hentry category-geral" id="post-192">
			<h2><a href="http://joaocosme.wordpress.com/2010/04/07/pensamentos-07042010/" rel="bookmark" title="Permanent link to Pensamentos…&nbsp;07/04/2010">Pensamentos…&nbsp;07/04/2010</a></h2>
			<p class="date">Posted by joaocosme em abril 7, 2010</p>
			<div class="entry">
				<p><span style="font-size: medium;">Um guerreiro da luz muitas vezes
 desanima.Acha que nada tem a emoção que ele esperava despertar. Muitas 
tardes e noites é obrigado a ficar sustentando uma posição conquistada, 
sem que nenhum acontecimento novo venha lhe devolver o entusiasmo.      
 Seus amigos comentam: “talvez sua luta já tenha terminado.”       O 
guerreiro sente dor e confusão ao escutar estes comentários porque sabe 
que não chegou onde queria. Mas é teimoso, e não abandona o que decidiu 
fazer.       Então, quando menos espera, uma nova porta se abre.</span></p>
			</div>

		<p class="category">Enviado em <a href="http://pt-br.wordpress.com/tag/geral/" title="Ver todos os posts em geral" rel="category tag">geral</a> |    <a href="http://joaocosme.wordpress.com/2010/04/07/pensamentos-07042010/#respond" title="Comentário para Pensamentos…&nbsp;07/04/2010">Deixar um comentário » </a></p>
		</div>

	
		<div class="post-155 post type-post status-publish format-standard hentry category-banco-de-dados category-linux category-postgresql" id="post-155">
			<h2><a href="http://joaocosme.wordpress.com/2009/10/30/ha-em-postgresql-warm-stand-by-heartbeat-hapm/" rel="bookmark" title="Permanent link to HA em Postgresql = Warm Stand By + HeartBeat +&nbsp;HAPM">HA em Postgresql = Warm Stand By + HeartBeat +&nbsp;HAPM</a></h2>
			<p class="date">Posted by joaocosme em outubro 30, 2009</p>
			<div class="entry">
				<h1>Prefácio hehehe</h1>
<p>Ja faz um bom tempo que eu gostaria de postar novamente, ando muito 
ocupado não sei se vocês sabem, mas estou no SERPRO em Porto Alegre 
agora envolvido não mais com o desenvolvimento em si do EXPRESSO&nbsp; 
mas com a&nbsp; a PRODUÇÃO!! Maravilha tudo o que eu queria….</p>
<p>AAAAA como é bom o cheiro dos servidores, aquele lindo terminal e 
finalmente Postgresql novamente …. O bom filho a casa retorna! 
Finalmente retornei com postgresql , não com a mesma exclusividade mas 
já é uma ótima!!</p>
<h1>Mandando o SALVE!!</h1>
<p>Galera gostaria de mandar um salve pros amigos que reencontrei no 
PGCON2009 e para os novas amizades que foram conquistadas , depois posto
 sobre o PGCON!!</p>
<p>Um salve pro meu brother Euler… esse já é irmão!!!</p>
<p>Um salve pro Minerin “Cara de coveiro”…</p>
<p>Um salve pro Léo Lindo e para a Cris….</p>
<p>Um salve pro Jovem “J”</p>
<p>Um salve pro Telles</p>
<p>Um salve pro Zé do Cleyssom de BSB (Agora convertido em Postgresql <img src="postgresql_ha_arquivos/icon_razz.gif" alt=":P" class="wp-smiley">  )</p>
<p>Um salve pro Diogo Biazus</p>
<p>Um salve pro pequeno inseto (Ele sabe quem é)</p>
<p>Um salve pro Roberto Mello (Cara 10 ….. PRAZER do Ca!@#$$# conhecer esse cabra)</p>
<p>Um salve pro Francisco , (Outro cara 10 …. que conheci tb em mais um evento)</p>
<p>Um salve pro GUTO de BSB….</p>
<p>Um salve pro “Rolon Boy” (Esse tb sabe quem é hehhe)</p>
<p>Um salve pro DUTRA.</p>
<p>Um salve pra Marisa (Valeu Marisaaaaaaaa……….. )</p>
<p>Um salve pro …. pra……</p>
<p>Um salve pro&nbsp; Galera do MEC ( O Rodrigão e o Marcelo)</p>
<p>Um salve pros brothers da CELEPAR( esqueci o nome foi mal)</p>
<p>Um salve pro Emanuel “EL Aprendiz” da Argentina !</p>
<p>Um salve pra geral que prestigiou o evento e a minha palestra!!</p>
<p style="text-align: center;"><span style="color: rgb(136, 136, 136);"><img class="aligncenter size-medium wp-image-184" title="2009-09-14-153739" src="postgresql_ha_arquivos/2009-09-14-153739.jpg" alt="2009-09-14-153739" height="225" width="300"></span></p>
<h1><strong>Voltando ao Post….</strong></h1>
<p>Vejo muita gente comentando sobre Replicação , alta disponibilidade, 
balanceamento de carga. Em vários eventos de SL são debatidos esses 
temas e como está na semana do PGCON 3 edição , acho que seria uma boa 
soltar um post de interesse de muita gente, pois é galera ai vai …. 
Vamos ganhar um dinheirinho com consultoria ai….</p>
<h1><strong>Cenário</strong></h1>
<p>Não irei entrar em conceitos como<strong> PITR, WAL</strong> , pá e 
bola…. Então são pré-requisitos para um bom entendimento!! Não que não 
consiga implementar sem esses conceitos mas véio de boa…. Estuda!! <img src="postgresql_ha_arquivos/icon_razz.gif" alt=":P" class="wp-smiley"> </p>
<h1>Um servidor primário e um servidor secundário.</h1>
<p>O&nbsp; servidor&nbsp; primário recebe as requisições&nbsp; feliz da 
vida&nbsp; e tranquilo , o servidor secundário fica em Stand-By em modo 
seca pimenteiro = on hehehe , pois ele não pode ser não pode ser 
acessado. Em um determinado momento meu servidor primário deixa de 
prover o serviço e…..</p>
<p>Meu servidor em Stand-by cheio de moral e doido para mostrar serviço,
 assume a posição&nbsp; do servidor primário de maneira&nbsp; 
“transparente” ao usuário… pois é … nem tudo é perfeito e o afobado 
jovem em stand by pode deixar um dado ou outro de lado <img src="postgresql_ha_arquivos/icon_razz.gif" alt=":P" class="wp-smiley"> </p>
<p>Nessa brincadeira ai&nbsp; já traçamos alguns conceitos importantes : <strong>Alta-disponibilidade
 , Replicação Síncrona e uma característica importante na implementação 
do stand-by (Não pode ser acessado nem para consulta)</strong></p>
<p><img class="aligncenter size-medium wp-image-156" title="HA-PG" src="postgresql_ha_arquivos/ha-pg.jpg" alt="HA-PG" height="171" width="312"></p>
<p>Para alcançar o objetivo iremos utilizar&nbsp; como coadjuvantes os softwares<strong> HAPM</strong> e o<strong> HeartBeat</strong> que nos possibilitaram a Alta-disponibilidade do serviço.</p>
<h1><strong>Configurando o Ambiente!</strong></h1>
<p>Anota ai jovem…</p>
<p><strong>Postgresql-8.3</strong><br>
<strong>postgresql-contrib-8.3 </strong><br>
<strong>heartbeat-2</strong><br>
<strong>nfs-kernel-server</strong><br>
<strong>hapm</strong></p>
<p>Vamos utilizar o<strong> Debian Lenny</strong> como exemplo e instalar os pacotes acima nas duas máquinas:</p>
<p><strong><em>apt-get install postgresql-8.3 heartbeat-2 nfs-kernel-server hapm&nbsp; postgresql-8.3-contrib</em></strong><strong> </strong></p>
<p><!-- 		@page { margin: 2cm } 		P { margin-bottom: 0.21cm } --></p>
<p style="margin-bottom: 0pt;">Uma vez instalados os pacotes nos dois servidores<span style="font-family: Arial;"> criaremos um local para arquivar os segmentos <strong><em>WAL</em></strong>. É altamente recomentados gravar os segmentos<strong> </strong><em><strong>WAL</strong> </em>remotamente do servidor primário, pois se o servidor primário cair , não teremos  acesso aos segmentos <strong>WAL</strong>, o que comprometeria a replicação e consequentemente a disponibilidade do sistema.</span></p>
<p><span style="font-family: Arial;"> Os arquivos  devem ter permissões 
de escrita e leitura para ambos os servidores. No exemplo que estamos 
demonstrando a técnica, criaremos um compartilhamento<strong> <em>NFS</em></strong> no servidor Stand By e o servidor primário exportará os arquivos<strong> WAL(cansei de colocar o Wal em negrito)</strong> para este determinado local. Tenha a certeza que o diretório pertença ao usuário postgres. Entendeu??</span></p>
<p><!-- 		@page { margin: 2cm } 		P { margin-bottom: 0.21cm } --></p>
<p style="margin-bottom: 0pt;">Criação do diretório na máquina slave&nbsp; para arquivamento&nbsp; no qual o usuário PostgreSQL pode escrever e ler:</p>
<p><!-- 		@page { margin: 2cm } 		P { margin-bottom: 0.21cm } --></p>
<p>Como usuário root:</p>
<p><strong><span style="font-family: Arial;"><em>mkdir /psql-archive </em></span></strong></p>
<p><strong><span style="font-family: Arial;"> <em>chown postgres.postgres /pgsql-archive </em></span></strong></p>
<p><strong><span style="font-family: Arial;"> <em> echo “/psql-archive IP_MASTER (rw,sync,no_subtree_check)” &gt;&gt; /etc/exports </em></span></strong></p>
<p><strong><span style="font-family: Arial;"> <em>exportfs -a </em></span></strong></p>
<p><strong><span style="font-family: Arial;"><em> su postgres -c “touch /psql-archive/mounted” </em></span></strong></p>
<p><strong><span style="font-family: Arial;"><em><br>
</em></span></strong></p>
<h1><strong><span style="font-family: Arial;">O que os comandos acima fazem??</span></strong></h1>
<p><span style="font-family: Arial;">Criamos um diretório chamado <strong>/psql-archive</strong> cujo o dono é o safadinho do usuário postgres e permitimos que a máquina </span><span style="font-family: Arial;">PRIMÁRIA</span><strong><span style="font-family: Arial;"> </span></strong><span style="font-family: Arial;">possa montar o diretório</span><strong><span style="font-family: Arial;"> </span></strong><span style="font-family: Arial;">remotamente podendo escrever e ler nele… já ia esquecer ,também criamos de ante-mão um arquivo lá no diretório chamado <strong>mounted</strong>… (aí está a mágica!!)</span></p>
<h1><strong>Agora na máquina primária</strong></h1>
<p><!-- 		@page { margin: 2cm } 		P { margin-bottom: 0.21cm } --></p>
<p style="margin-bottom: 0pt;"><strong><span style="font-family: Arial;"><em>mkdir /psql-archive </em></span></strong></p>
<p><strong><span style="font-family: Arial;"><em> chown postgres.postgres /psql-archive </em></span></strong></p>
<p><strong><span style="font-family: Arial;"><em> mount IP_SLAVE:/psql-archive /psql-archive </em></span></strong></p>
<p><strong><span style="font-family: Arial;"><em><br>
</em></span></strong></p>
<h1><strong><strong><span style="font-family: Arial;">O que os comandos acima fazem??</span></strong></strong></h1>
<p><strong> </strong></p>
<p><span style="font-family: Arial;">Agora na máquina primária criamos um diretório chamado<strong> /psql-archive</strong> cujo o dono&nbsp; é o postgres montamos remotamente o diretório da máquina slave psql-archive no <strong>/psql-archive</strong> do primário.</span></p>
<p><span style="font-family: Arial;"><br>
</span></p>
<h1><strong><span style="font-family: Arial;">Ainda na máquina primária iremos ativar o recurso de WALs :</span></strong></h1>
<p><!-- 		@page { margin: 2cm } 		P { margin-bottom: 0.21cm } --></p>
<p style="margin-bottom: 0pt;"><span style="font-family: Arial;"><em>no arquivo</em><span style="font-style: normal;"> </span><span style="font-style: normal;"><strong>/etc/postgresql/8.3/main/postgresql.conf </strong></span><em>alterar as seguintes linhas: </em></span></p>
<p><strong><span style="font-family: Arial;"><em> <span style="font-weight: normal;">archive_mode = on </span></em></span></strong><em> </em></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>
 archive_command = “test -f /psql_archive/mounted &amp;&amp; test ! -f 
/psql_archive/%f 		&amp;&amp; rsync -a %p /psql_archive/%f”</em></span></strong></p>
<p><span style="font-family: Arial;">Que lindo o archive_command!!! Fandásdigo como diria tiririca, confesso esse eu copiei&nbsp; hehehhe mas eu sei o que ele faz <img src="postgresql_ha_arquivos/icon_smile.gif" alt=":)" class="wp-smiley"> </span></p>
<p><span style="font-family: Arial;">Vamos por partes!!!</span></p>
<p><span style="font-family: Arial;">arvhice command = (condicao 1) &amp;&amp; (condicao 2)</span></p>
<p><span style="font-family: Arial;">Condição 1 = teste -f /psql/mounted </span></p>
<p><span style="font-family: Arial;"> Lembra do comando<strong> touch /psql/mounted</strong> no servidor seca pimenteiro, ops .. escravo?? O que ele faz é verificar se o arquivo <strong>mounted</strong> existe, se ele existir significa que a partição remota está montada&nbsp; <img src="postgresql_ha_arquivos/icon_smile.gif" alt=":)" class="wp-smiley"> <em> </em></span></p>
<p><span style="font-family: Arial;">Condição 2 = <em>test ! -f /psql_archive/%f 		&amp;&amp; rsync -a %p /psql_archive/%f </em></span></p>
<p><span style="font-family: Arial;">Verifica se já existe o arquivo Wall no secundário , se não existir ele copia o Wal file para lá <img src="postgresql_ha_arquivos/icon_smile.gif" alt=":)" class="wp-smiley"> </span></p>
<p><span style="font-family: Arial;">o “&amp;&amp;”,&nbsp; elementar meu caro as duas condições tem que serem válidas ou seja </span></p>
<p><span style="font-family: Arial;">(particao tem que estar montada ) e (nao deve existir o arquivo no diretorio la no escravo)<br>
</span></p>
<p style="font-weight: normal;">
</p><p style="font-weight: normal;"><span style="font-family: Arial;"><span style="font-style: normal;">Reiniciar o serviço do PostgreSQL</span></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><span style="font-style: normal;"> </span><strong><em>/etc/init.d/Postgresql-8.3 restart</em></strong></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;">A 
Partir deste momento meu caro parabéns, já está gerando arquivos Wals e o
 mais legal, lá no diretório do escravo… nossa imagina o cabra ter que 
suportar ter que ser secundário e neguin escrevendo no diretório dele 
hehehh.</span></p>
<h3>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;">Prova dos 9!</span></strong></p>
</h3>
<p style="font-weight: normal;"><span style="font-family: Arial;">Vamos lá… </span></p>
<p><!-- 		@page { margin: 2cm } 		P { margin-bottom: 0.21cm } --></p>
<p style="font-style: normal; font-weight: normal;"><span style="font-family: Arial;">Agora devemos fazer o backup básico do diretório <strong>$PGDATA</strong>, sem a necessidade de parar o banco de dados , isso no servidor primário logicamente.</span></p>
<p><!-- 		@page { margin: 2cm } 		P { margin-bottom: 0.21cm } --></p>
<p style="margin-bottom: 0pt; font-weight: normal;"><strong><span style="font-family: Arial;"><em>psql  -U postgres </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>Bem vindo ao psql 8.3.3, o terminal iterativo do PostgreSQL. </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>Digite:  \copyright para mostrar termos de distribuição </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>\h para ajuda com comandos SQL </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>\? para ajuda com comandos do psql </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>\g ou terminar com ponto-e-vírgula para executar a consulta </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>\q para sair </em></span></strong></p>
<p style="font-weight: normal;"><strong><br>
</strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>postgres=# select pg_start_backup(‘meu_backup’); </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>pg_start_backup </em></span></strong></p>
<p><!-- 		@page { margin: 2cm } 		P { margin-bottom: 0.21cm } --></p>
<p style="margin-bottom: 0pt; font-weight: normal;"><strong><span style="font-family: Arial;"><em>2/CE005F40 </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>(1 registro) </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>postgres=# \q </em></span></strong></p>
<p><!-- 		@page { margin: 2cm } 		P { margin-bottom: 0.21cm } --></p>
<p style="margin-bottom: 0pt; font-weight: normal;"><strong><span style="font-family: Arial;"><em># su – postgres </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em># cd /var/lib/Postgresql/8.3/ </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>$ tar -czf /psql-archive/base_backup.tar.gz * </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>tar: Removendo `/’ inicial dos nomes dos membros </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>tar: main/pg_xlog/0000000100000002000000CF: arquivo alterado enquanto estava sendo lido </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>….. </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>….. </em></span></strong></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>….. </em></span></p>
<p style="font-style: normal; font-weight: normal;"><span style="font-family: Arial;">Estamos gerando um backup a fisico do diretório de dados e colocando no diretório compartilhado <strong>/psql-archive</strong> . Uma vez terminado o backup, conectar no banco de dados e efetuar o seguinte comando: </span></p>
<p style="font-style: normal; font-weight: normal;">
</p><p><!-- 		@page { margin: 2cm } 		P { margin-bottom: 0.21cm } --></p>
<p style="margin-bottom: 0pt; font-weight: normal;"><strong><span style="font-family: Arial;"><em>psql  -U postgres -h localhost </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>Bem vindo ao psql 8.3.3, o terminal iterativo do Postgresql. </em></span></strong></p>
<p style="font-weight: normal;"><strong><br>
</strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>Digite:  \copyright para mostrar termos de distribuição </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>\h para ajuda com comandos SQL </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>\? para ajuda com comandos do psql </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>\g ou terminar com ponto-e-vírgula para executar a consulta </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>\q para sair </em></span></strong></p>
<p style="font-weight: normal;"><strong><br>
</strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>conexão SSL (cifra: DHE-RSA-AES256-SHA, bits: 256) </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>postgres=# select pg_stop_backup(); </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>pg_stop_backup </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>—————- </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>2/D000BC0C </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>(1 registro) </em></span></strong></p>
<p style="font-weight: normal;"><strong><br>
</strong></p>
<p style="margin-bottom: 0pt;"><strong><span style="font-family: Arial;"><em>postgres=# \q</em></span></strong></p>
<p style="margin-bottom: 0pt;"><strong><span style="font-family: Arial;"><em><br>
</em></span></strong></p>
<h1>
<p style="margin-bottom: 0pt;"><strong>Na máquina 			secundária novamente </strong></p>
</h1>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em> <strong>mv /var/lib/Postgresql/8.3/main /var/lib/Postgresql/8.3/main.old </strong></em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;">Estamos renomeando o $PGDATA da máquina secundária para $PGDATA.old<br>
</span></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em> mv /psql-archive/base_backup.tar.gz  /var/lib/Postgresql/8.3 </em></span></strong></p>
<p style="font-weight: normal;"><span style="font-family: Arial;">Copiando o backup do servidor primário para o diretório /<strong>var/lib/Postgresql;8.3</strong><br>
</span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em> <strong>tar -xzvf /var/lib/Postgresql/8.3 </strong></em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;">Mandando bala descompactando o danado…<em><br>
</em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em> <strong>cd /var/lib/Postgresql/8.3/main/ </strong></em></span></p>
<p><span style="font-family: Arial;">Entrando no diretório $PGDATA novo do secundário…<em><br>
</em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em> <strong>rm -Rf ./pg_xlog/* </strong></em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;">Removendo os arquivos do pg_xlog do primário…. <strong>Cansei…</strong></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;">Vamos vamos…. Vamos !!!!!</span></p>
<p><!-- 		@page { margin: 2cm } 		P { margin-bottom: 0.21cm } --></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em> </em><span style="font-style: normal;">Criação do arquivo </span><span style="font-style: normal;"><strong>recovery.conf</strong></span><span style="font-style: normal;"> na máquina para o modo contínuo de 				recovery dentro do $PGDATA ( /var/lib/Postgresql/8.3/main/) com a seguinte linha: </span></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em> <strong>restore_command = ‘</strong></em></span><strong>/usr/lib/postgresql/8.3/bin/<span style="font-family: Arial;"><em>pg_standby -d -l -r 3 -s 60 -t /psql_archive/trigger.done  /psql_archive 	%f %p %r 2&gt;&gt;/tmp/pg_standby.log’ </em></span></strong></p>
<p style="font-style: normal; font-weight: normal;"><span style="font-family: Arial;">Essa linha basicamente indica o Postgresql para continuar o <em>recovery</em> até encontrar um arquivo chamado <strong>/psql-archive/trigger.done</strong>,
 ou seja , quando o servidor primário cair, um arquivo trigger.done será
 criado e o procedimento da subida do servidor slave é iniciado.</span></p>
<p style="font-style: normal; font-weight: normal;"><span style="font-family: Arial;"><br>
</span></p>
<h1 style="font-style: normal; font-weight: normal;"><strong><span style="font-family: Arial;">Iniciando o servidor Stand by</span></strong></h1>
<p><!-- 		@page { margin: 2cm } 		P { margin-bottom: 0.21cm } --></p>
<p style="margin-bottom: 0pt; font-weight: normal;"><span style="font-family: Arial;"><em><strong>#&nbsp; /etc/init.d/Postgresql-8.3 start </strong></em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>* Starting Postgresql 8.3 database server </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>[ OK ] </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em> </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em># <strong>tail -f /tmp/pg_standby.log </strong></em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>Keep archive history    : 000000000000000000000000 and later </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>running restore         : OK </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>Trigger file            : /psql-archive/trigger.done </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>Waiting for WAL file    : 000000020000000200000088 </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>WAL file path           : /psql-archive/000000020000000200000088 </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>Restoring to…         : pg_xlog/RECOVERYXLOG </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>Sleep interval          : 60 seconds </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>Max wait interval       : 0 forever </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>Command for restore     : ln -s -f “/psql-archive/000000020000000200000088″ “pg_xlog/RECOVERYXLOG” </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>Keep archive history    : 000000000000000000000000 and later </em></span></p>
<p style="font-weight: normal;"><strong>Que lindo Que lindo …. Vamos Vamos…</strong></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em> </em><span style="font-style: normal;">Criação do arquivo </span><span style="font-style: normal;"><strong>recovery.conf</strong></span><span style="font-style: normal;"> na máquina para o modo contínuo de 				recovery dentro do $PGDATA ( /var/lib/Postgresql/8.3/main/) com a seguinte linha: </span></span></p>
<p style="font-weight: normal;">
</p><p style="font-weight: normal;"><span style="font-family: Arial;"><em> <strong>restore_command
 = ‘pg_standby -d -l -r 3 -s 60 -t /psql_archive/trigger.done  
/psql_archive 	%f %p %r 2&gt;&gt;/tmp/pg_standby.log’ </strong></em></span></p>
<p style="font-weight: normal;">
</p><p style="font-style: normal; font-weight: normal;"><span style="font-family: Arial;">Essa linha basicamente indica o Postgresql para continuar o <em>recovery</em> até encontrar um arquivo chamado <strong>/psql-archive/trigger.done</strong>,
 ou seja , quando o servidor primário cair, um arquivo trigger.done será
 criado e o procedimento da subida do servidor slave é iniciado.</span></p>
<p style="font-style: normal; font-weight: normal;"><span style="font-family: Arial;"><br>
</span></p>
<p><!-- 		@page { margin: 2cm } 		P { margin-bottom: 0.21cm } --></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>#psql  -U postgres -h localhost </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>psql: FATAL:  o sistema de banco de dados está iniciando ou seja esta em restore continuo.</em></span></strong></p>
<p style="font-weight: normal;">????? Num intindi nada!!!???</p>
<p style="margin-bottom: 0pt;"><span style="font-family: Arial;">O servidor está em <em>restore </em>constante!!!! Não temos como acessar o servidor (WARM Stand by Falei isso lá em cimaaa nocomeço do Post)</span></p>
<h1>
<p style="margin-bottom: 0pt;"><strong>Gerando arquivos 			Wals para serem replicados a partir do host primário</strong></p>
</h1>
<p style="font-style: normal; font-weight: normal;"><span style="font-family: Arial;">Começaremos a gerar alguns arquivos Wals .</span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>#<strong> psql  -U postgres </strong></em></span></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>Bem vindo ao psql 8.3.3, o terminal iterativo do Postgresql. </em></span></strong></p>
<p style="font-weight: normal;"><strong><br>
</strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>Digite:  \copyright para mostrar termos de distribuição </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>\h para ajuda com comandos SQL </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>\? para ajuda com comandos do psql </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>\g ou terminar com ponto-e-vírgula para executar a consulta </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>\q para sair </em></span></strong></p>
<p style="font-weight: normal;"><strong><br>
</strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>postgres=# create table teste as select * from pg_class, pg_attribute; </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>SELECT </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>postgres=# create table teste1 as select * from pg_class, pg_attribute; </em></span></strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>SELECT </em></span></strong></p>
<p style="font-weight: normal;"><strong><br>
</strong></p>
<p style="font-weight: normal;"><strong><span style="font-family: Arial;"><em>postgres=#\q </em></span></strong></p>
<p style="font-weight: normal;">
</p><p style="font-style: normal; font-weight: normal;"><span style="font-family: Arial;">Vários arquivos Wals foram gerados e gravados no diretório especificado no <em><strong>archive_command</strong>, </em>configuração do servidor que no caso, mais uma vez pra não se perder&nbsp; o tal <strong>/psql-archive</strong> que está montado na máquina primária .<br>
</span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em># <strong>ls -l /psql-archive<br>
</strong></em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>total 738184 </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>-rw——- 1 postgres postgres 16777216 2009-10-06 16:31 0000000100000002000000CE </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>-rw——- 1 postgres postgres      246 2009-10-06 16:35 0000000100000002000000CE.00005F40.backup </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>-rw——- 1 postgres postgres 16777216 2009-10-06 16:33 0000000100000002000000CF </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>-rw——- 1 postgres postgres 16777216 2009-10-06 16:35 0000000100000002000000D0 </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>-rw——- 1 postgres postgres 16777216 2009-10-06 16:37 0000000100000002000000D1 </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>-rw——- 1 postgres postgres 16777216 2009-10-06 16:39 0000000100000002000000D2 </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>-rw——- 1 postgres postgres 16777216 2009-10-06 16:41 0000000100000002000000D3 </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>-rw——- 1 postgres postgres 16777216 2009-10-06 16:43 0000000100000002000000D4 </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>-rw——- 1 postgres postgres 16777216 2009-10-06 16:45 0000000100000002000000D5 </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>-rw——- 1 postgres postgres 16777216 2009-10-06 16:47 0000000100000002000000D6 </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>-rw——- 1 postgres postgres 16777216 2009-10-06 16:49 0000000100000002000000D7 </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>-rw——- 1 postgres postgres 16777216 2009-10-06 16:51 0000000100000002000000D8 </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>-rw——- 1 postgres postgres 16777216 2009-10-06 16:51 0000000100000002000000D9 </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>-rw——- 1 postgres postgres 16777216 2009-10-06 16:51 0000000100000002000000DA </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>-rw——- 1 postgres postgres 16777216 2009-10-06 16:51 0000000100000002000000DB </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>-rw——- 1 postgres postgres 16777216 2009-10-06 16:51 0000000100000002000000DC </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>-rw——- 1 postgres postgres 16777216 2009-10-06 16:51 0000000100000002000000DD </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>-rw——- 1 postgres postgres 16777216 2009-10-06 16:51 0000000100000002000000DE </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>-rw——- 1 postgres postgres 16777216 2009-10-06 16:51 0000000100000002000000DF </em></span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em>-rw——- 1 postgres postgres 16777216 2009-10-06 16:51 0000000100000002000000E0 </em></span></p>
<p style="margin-bottom: 0pt;"><span style="font-family: Arial;"><em>-rw——- 1 postgres postgres 16777216 2009-10-06 16:51 0000000100000002000000E1</em></span></p>
<p style="margin-bottom: 0pt;"><span style="font-family: Arial;"><em><br>
</em></span></p>
<p style="margin-bottom: 0pt;">
</p><h1>
<p style="margin-bottom: 0pt;"><strong>Testando a 	replicação para a máquina em Stand By</strong></p>
</h1>
<p style="font-style: normal; font-weight: normal;"><span style="font-family: Arial;">Agora criaremos o arquivo <em>/tmp/trigger.done. </em></span></p>
<p><span style="font-family: Arial;"><em><strong>touch /psql-archive/trigger.done </strong></em></span></p>
<p style="font-style: normal; font-weight: normal;"><span style="font-family: Arial;">Neste momento, o servidor<em> Stand By </em>detectará que deve sair do modo<em> recovery</em> e levantar o serviço.<strong> </strong>Ou seja, quando o arquivo <strong>/psql-archive/trigger.done</strong> existir, o servidor em  Stand By sai do modo <em>recovery </em>e passa a operar normalmente.<strong> </strong> Você pode logar no servidor Stand By e verificar as tabelas criadas. </span></p>
<p style="font-style: normal; font-weight: normal;">
</p><h1 style="font-style: normal; font-weight: normal;"><span style="font-family: Arial;">To be continued…</span></h1>
<p style="font-style: normal; font-weight: normal;"><span style="font-family: Arial;">Até
 agora implementamos o Warm Stand by… Sem alta disponibilidade…..&nbsp; o
 próximo post mostro como garantir a disponibilidade de forma que o 
servidor escravo assuma o ip do outro servidor mantendo a 
disponibilidade do serviço…<br>
</span></p>
<p style="font-style: normal; font-weight: normal;"><span style="font-family: Arial;"><br>
</span></p>
<p style="font-weight: normal;"><span style="font-family: Arial;"><em><br>
</em></span></p>
			</div>

		<p class="category">Enviado em <a href="http://pt-br.wordpress.com/tag/banco-de-dados/" title="Ver todos os posts em Banco de dados" rel="category tag">Banco de dados</a>, <a href="http://pt-br.wordpress.com/tag/linux/" title="Ver todos os posts em Linux" rel="category tag">Linux</a>, <a href="http://pt-br.wordpress.com/tag/postgresql/" title="Ver todos os posts em Postgresql" rel="category tag">Postgresql</a> |    <a href="http://joaocosme.wordpress.com/2009/10/30/ha-em-postgresql-warm-stand-by-heartbeat-hapm/#comments" title="Comentário para HA em Postgresql = Warm Stand By + HeartBeat +&nbsp;HAPM">8 Comentários »</a></p>
		</div>

	
		<div class="post-154 post type-post status-publish format-standard hentry category-uncategorized" id="post-154">
			<h2><a href="http://joaocosme.wordpress.com/2009/09/10/a-journey-of-a-thousand-miles-must-begin-with-a-single-step/" rel="bookmark" title="Permanent link to A journey of a thousand miles must begin with a single&nbsp;step….">A journey of a thousand miles must begin with a single&nbsp;step….</a></h2>
			<p class="date">Posted by joaocosme em setembro 10, 2009</p>
			<div class="entry">
							</div>

		<p class="category">Enviado em <a href="http://joaocosme.wordpress.com/category/uncategorized/" title="Ver todos os posts em Uncategorized" rel="category tag">Uncategorized</a> |    <a href="http://joaocosme.wordpress.com/2009/09/10/a-journey-of-a-thousand-miles-must-begin-with-a-single-step/#respond" title="Comentário para A journey of a thousand miles must begin with a single&nbsp;step….">Deixar um comentário » </a></p>
		</div>

	
		<div class="post-151 post type-post status-publish format-standard hentry category-uncategorized" id="post-151">
			<h2><a href="http://joaocosme.wordpress.com/2009/08/10/flag-seen-problem-cyrus-all-messages-unread/" rel="bookmark" title="Permanent link to FLAG SEEN PROBLEM + CYRUS + ALL Messages&nbsp;Unread!">FLAG SEEN PROBLEM + CYRUS + ALL Messages&nbsp;Unread!</a></h2>
			<p class="date">Posted by joaocosme em agosto 10, 2009</p>
			<div class="entry">
				<p>Um determinado usuário reclamava que todas as suas mensagens 
apareciam como unread. Por mais que ele abrisse e quando logasse 
novamente no sistema. Analisando os Logs encontrei.</p>
<p>Aug 10 18:11:14 ****** : DBERROR: opening /data/imap/user/q/039…..seen: cyrusdb error</p>
<p>Solução::<br>
Sem restartar o server, entrei no diretório acima e apaguei o arquivo user.seen</p>
<p>Usuário Feliz e mais um problema resolvido!!</p>
			</div>

		<p class="category">Enviado em <a href="http://joaocosme.wordpress.com/category/uncategorized/" title="Ver todos os posts em Uncategorized" rel="category tag">Uncategorized</a> |    <a href="http://joaocosme.wordpress.com/2009/08/10/flag-seen-problem-cyrus-all-messages-unread/#respond" title="Comentário para FLAG SEEN PROBLEM + CYRUS + ALL Messages&nbsp;Unread!">Deixar um comentário » </a></p>
		</div>

	
		<div class="post-135 post type-post status-publish format-standard hentry category-linux" id="post-135">
			<h2><a href="http://joaocosme.wordpress.com/2009/07/27/apache-load-balance-lenny/" rel="bookmark" title="Permanent link to Apache + Load Balance +&nbsp;Lenny">Apache + Load Balance +&nbsp;Lenny</a></h2>
			<p class="date">Posted by joaocosme em julho 27, 2009</p>
			<div class="entry">
				<p>Por curiosidade, fui atrás de uma solução de balanceamento de 
carga entre servidores&nbsp; apache. Aqui no trampo,&nbsp; o&nbsp; 
balanceamento de carga em cima dos servidores apache é feita através de 
hardware&nbsp; …. eu queria ver como seria possível utilizando o próprio
 apache como proxy reverso, vi que era possível utilizando o <strong>mod_proxy</strong> do apache</p>
<p>Após dois dias, alguns&nbsp;&nbsp; HOWTOS que não funcionam devido ao
 problema de balanceamento de sessões (sticksessions) e uma aula de boxe
 perdida, obtive a solução, BINGO!</p>
<h1><strong>Apache como Proxy Reverso </strong></h1>
<p>Segundo o Wiki …. “Proxy reverso é um servidor proxy que é fica na 
frente de outros servidores. Tipicamente proxy reverso&nbsp; é usado na 
frente de servidores web. Todas as conexões vindo da internet 
endereçadas para um dos servidores web são roteadas&nbsp; pelo proxy 
server… “</p>
<p>Ou seja, toda e qualquer conexão passa pelo proxy server, que é o ponto de contato entre o cliente e os servidores.</p>
<h1>Razões para utilizar um proxy reverso</h1>
<ul>
<li><strong>Segurança</strong>: o proxy server provê uma camada 
adicional de segurança separando ou mascarando os tipos de servidores 
que estão atrás do proxy.</li>
</ul>
<ul>
<li><strong>Encripitação/ SSL acceleration</strong>: Quando sites 
seguros são criados, a encriptação SSL as vezes não é realizada pelo 
servidor web e sim pelo proxy reverso que é equipado por um hardware de 
aceleração SSL.</li>
</ul>
<ul>
<li><strong>Balanceamento de carga</strong>:&nbsp; Proxy reverso pode distribuir a carga em vários servidores .</li>
</ul>
<ul>
<li><strong>Caching</strong>: Um proxy reverso pode diminuir a carga dos
 servidores web promovendo cache, diminuindo consideravelmente o&nbsp; 
número de requisições nos servidores web.</li>
</ul>
<ul>
<li><strong>Compressão :</strong> O proxy&nbsp; pode otimizar e comprimir o conteúdo aumentando assim a velocidade.</li>
</ul>
<h1><strong>Cenário </strong></h1>
<p style="text-align: center;"><img class="aligncenter size-medium wp-image-137" title="basicClustered.preview" src="postgresql_ha_arquivos/basicclustered-preview.jpg" alt="basicClustered.preview" height="270" width="500"></p>
<p style="text-align: center;">
</p><p style="text-align: left;">Cenário bem simples: Um proxy reverso 
na frente dos servidores apache. Toda e qualquer requisição é feita 
diretamente no proxy que realiza o balanceamento de carga.</p>
<h1>
<p style="text-align: left;"><strong>Beleza… ele realiza o balanceamento
 de carga mas… meu site não é estático… tb faço uso de&nbsp;&nbsp; 
seções e aí? ele é capaz de saber em qual apache está minha seção??<br>
</strong></p></h1>
<p style="text-align: left;">Calma jovem, a solução a seguir contempla 
esse tipo de dúvida!! No proxy será criado um coockie balanceado&nbsp; 
que será roteado para o servidor web correto!&nbsp; <code>That's the point!!</code></p>
<p style="text-align: left;"><code> Esse foi o grande lance da solução. 
todos os HowTo espalhados exigiam modificações tanto no proxy quanto nos
 apaches que estão em baixo e esta solução não... só a configuração no 
proxy.<br>
</code></p>
<h1>
<p style="text-align: left;"><strong>Instalação:</strong></p>
</h1>
<p style="text-align: left;">Com os pacotes do apache e php já instalados devemos ativar o modúlos <strong>mod_proxy , mod_headers .<br>
</strong> A maneira Debian de ser…<strong> </strong>Digite!<strong><br>
</strong></p>
<p>#<em> a2enmod proxy </em></p>
<p>Module proxy&nbsp; installed; run /etc/init.d/apache2 force-reload to enable.</p>
<p style="text-align: left;">#<em> a2enmod header</em></p>
<p>Module headers installed; run /etc/init.d/apache2 force-reload to enable.</p>
<h1><strong>Configuração:</strong></h1>
<p>No virtual host do proxy adicione as seguintes configurações</p>
<p>———————————————————————————————————————</p>
<p>Header add Set-Cookie “MYCOOKIE=SOMEVALUE.%{BALANCER_WORKER_ROUTE}e; path=/;” env=BALANCER_ROUTE_CHANGED</p>
<p>ProxyPass / balancer://cluster/ lbmethod=byrequests stickysession=MYCOOKIE</p>
<p>&lt;Proxy balancer://cluster&gt;<br>
BalancerMember http://192.168.1.24 route=www1<br>
BalancerMember http://192.168.1.25&nbsp; route=www2<br>
&lt;/Proxy&gt;</p>
<p>ProxyPassReverse / http://192.168.1.24/<br>
ProxyPassReverse / http://192.168.1.25/</p>
<p>—————————————————————————————————————————–</p>
<p>lbmethod : método de balanceamento entre os servidores.<em> </em></p>
<p><em>byrequests |bytraffic| bybusyness : o default é byrequest , vide documentação do&nbsp; mod_proxy do apache.</em></p>
<p>stickysession=MYCOOKIE</p>
<p><em>nome do cookie balanceado:&nbsp; O valor é geralmente setado como: <code>JSESSIONID</code> ou&nbsp; <code>PHPSESSIONID</code></em></p>
<p>BalancerMember: Cada host que compões os servidores web que serão balanceado</p>
<h1>Testando…</h1>
<p>Utilizando o browser acessamos o nosso proxy  
http://ip_do_proxy.&nbsp; Agora para matar a curiosidade veja os cookies
 no browser mais precisamente a variavel MYCOOkIE nos cookies do proxy!</p>
			</div>

		<p class="category">Enviado em <a href="http://pt-br.wordpress.com/tag/linux/" title="Ver todos os posts em Linux" rel="category tag">Linux</a> |    <a href="http://joaocosme.wordpress.com/2009/07/27/apache-load-balance-lenny/#comments" title="Comentário para Apache + Load Balance +&nbsp;Lenny">4 Comentários »</a></p>
		</div>

	
		<div class="post-121 post type-post status-publish format-standard hentry category-uncategorized" id="post-121">
			<h2><a href="http://joaocosme.wordpress.com/2009/04/29/duelo-de-titas/" rel="bookmark" title="Permanent link to Duelo de&nbsp;Titãs!!!">Duelo de&nbsp;Titãs!!!</a></h2>
			<p class="date">Posted by joaocosme em abril 29, 2009</p>
			<div class="entry">
				
		<style type="text/css">
			#gallery-1 {
				margin: auto;
			}
			#gallery-1 .gallery-item {
				float: left;
				margin-top: 10px;
				text-align: center;
				width: 50%;
			}
			#gallery-1 img {
				border: 2px solid #cfcfcf;
			}
			#gallery-1 .gallery-caption {
				margin-left: 0;
			}
		</style>
		<!-- see gallery_shortcode() in wp-includes/media.php -->
		<div id="gallery-1" class="gallery galleryid-121 gallery-columns-2 gallery-size-thumbnail snap_nopreview"><dl class="gallery-item">
			<dt class="gallery-icon">
				<a href="http://joaocosme.wordpress.com/2009/04/29/duelo-de-titas/maldito2/" title="Duelo de Titãs!!"><img src="postgresql_ha_arquivos/maldito2.jpeg" class="attachment-thumbnail" alt="Duelo de Titãs!!" title="Duelo de Titãs!!" height="112" width="150"></a>
			</dt>
				<dd class="wp-caption-text gallery-caption">
				Duelo de Titãs!!
				</dd></dl><dl class="gallery-item">
			<dt class="gallery-icon">
				<a href="http://joaocosme.wordpress.com/2009/04/29/duelo-de-titas/maldito-2/" title="Duelo de Titãs"><img src="postgresql_ha_arquivos/maldito.jpeg" class="attachment-thumbnail" alt="Maldito sendo finalizado" title="Duelo de Titãs" height="112" width="150"></a>
			</dt>
				<dd class="wp-caption-text gallery-caption">
				Maldito sendo finalizado
				</dd></dl><br style="clear: both;">
			<br style="clear: both;">
		</div>

			</div>

		<p class="category">Enviado em <a href="http://joaocosme.wordpress.com/category/uncategorized/" title="Ver todos os posts em Uncategorized" rel="category tag">Uncategorized</a> |    <a href="http://joaocosme.wordpress.com/2009/04/29/duelo-de-titas/#respond" title="Comentário para Duelo de&nbsp;Titãs!!!">Deixar um comentário » </a></p>
		</div>

	
		<div class="post-110 post type-post status-publish format-standard hentry category-uncategorized" id="post-110">
			<h2><a href="http://joaocosme.wordpress.com/2009/04/08/equipe-de-desenvolvimento-do-expresso-poa/" rel="bookmark" title="Permanent link to Equipe de desenvolvimento do Expresso&nbsp;POA">Equipe de desenvolvimento do Expresso&nbsp;POA</a></h2>
			<p class="date">Posted by joaocosme em abril 8, 2009</p>
			<div class="entry">
				<p style="text-align: center;"><img class="aligncenter size-full wp-image-109" title="Equipe de desenvolvimento do Expresso SERPRO POA" src="postgresql_ha_arquivos/expresso1.jpeg" alt="Equipe de desenvolvimento do Expresso SERPRO POA" height="501" width="669"></p>
<p>Depois de assumir no concurso aqui do SERPRO em POA fui alocado num 
projeto chamado   EXPRESSO, um projeto muito interessante utilizando 
Software LIVRE!!! Pois é, caí  no desenvolvimento apesar da minha paixão
 ser o bom e velho Postgresql que não pretendo deixar de lado mas vamos 
lá….</p>
<p>AHH para quem não me conhece eu sou o de camiseta amarela (Olha… o elefante ali nela!) e um dos braços todo riscado hehehe</p>
			</div>

		<p class="category">Enviado em <a href="http://joaocosme.wordpress.com/category/uncategorized/" title="Ver todos os posts em Uncategorized" rel="category tag">Uncategorized</a> |    <a href="http://joaocosme.wordpress.com/2009/04/08/equipe-de-desenvolvimento-do-expresso-poa/#comments" title="Comentário para Equipe de desenvolvimento do Expresso&nbsp;POA">2 Comentários »</a></p>
		</div>

	
		<div class="post-105 post type-post status-publish format-standard hentry category-geral" id="post-105">
			<h2><a href="http://joaocosme.wordpress.com/2009/04/08/tribo-de-jah-orai-vigiai-a-babilonia-vai-cair/" rel="bookmark" title="Permanent link to Tribo de Jah Orai, Vigiai, A Babilônia Vai&nbsp;Cair">Tribo de Jah Orai, Vigiai, A Babilônia Vai&nbsp;Cair</a></h2>
			<p class="date">Posted by joaocosme em abril 8, 2009</p>
			<div class="entry">
				<p>Eu vejo os brotos dessa nova geração<br>
Crianças, garotos, ainda em formação<br>
Eu vejo com apreensão, vivendo nestes tempos<br>
Tempos de dissolução, rebentos sem discernimento</p>
<p>Há tanta mídia, tanta desinformação<br>
Fazendo mais e mais, escravos da ilusão<br>
Mas o dia vai chegar, mais cedo do que se crê<br>
E nada será como está, todos irão se render, a brutal transformação</p>
<p>Não pense nunca que o mal triunfará<br>
Nada, ninguém jamais irá mudar, os rumos da criação<br>
Jah é o único, tesouro a se buscar<br>
Desperte, liberte-se, entregue a Jah teu coração</p>
<p>Orai, vigiai, clamai em nome do Senhor<br>
Só Ele pode nos guiar, só Ele vai nos conduzir<br>
A Babilônia em breve vai se abalar<br>
E vai tremer, vai tremer, tremer até cair</p>
<p>Vai, vai, vai, vai ruir, ruir<br>
Vai tremer até cair<br>
Vai, vai, vai, vai ruir, ruir<br>
A Babilônia vai cair</p>
<p>Todo poder transitório ruirá por sua vez<br>
Corroído em suas próprias entranhas de desmandos e, insensatez<br>
Assim passará a Babilônia sob o manto sombrio<br>
Da corrupção, da fome e da guerra<br>
Consumida em múltiplas noites de insônia<br>
Só os mansos e pacíficos herdarão o reino da terra<br>
Soon Babylon shall fall down</p>
<p>Música show de bola!!! Jah rastafari!!</p>
			</div>

		<p class="category">Enviado em <a href="http://pt-br.wordpress.com/tag/geral/" title="Ver todos os posts em geral" rel="category tag">geral</a> |    <a href="http://joaocosme.wordpress.com/2009/04/08/tribo-de-jah-orai-vigiai-a-babilonia-vai-cair/#respond" title="Comentário para Tribo de Jah Orai, Vigiai, A Babilônia Vai&nbsp;Cair">Deixar um comentário » </a></p>
		</div>

	
		<div class="post-21 post type-post status-publish format-standard hentry category-postgresql" id="post-21">
			<h2><a href="http://joaocosme.wordpress.com/2009/04/01/comecando-com-o-londiste/" rel="bookmark" title="Permanent link to Começando com o&nbsp;Londiste…">Começando com o&nbsp;Londiste…</a></h2>
			<p class="date">Posted by joaocosme em abril 1, 2009</p>
			<div class="entry">
				<p>Mais uma vez resolvi dedicar um tempinho e mexer com as 
ferramentas do SkyTools, o Londiste. Esse post já tem quase um ano , 
estava nos seus 80% mas por motivos maiores de falta de tempo, trampo ….
 e vcs sabem a “caixa é uma vidinha de surpresas”…</p>
<p>Aproveitando a proximidade do PGDAY ,um dia dedicado ao nosso querido
 Postgresql&nbsp; (Estou realmente pensando em bolar alguma palestra 
com&nbsp; PL/PROXY e Londiste aqui no PGDAY de Porto Alegre) , resolvi 
terminar de escrever sobre o londiste, e como promessa é dívida….</p>
<p>Primeiro foi o plproxy agora é a vez do londiste. Não esqueci não, 
vou postar algumas coisinhas que eu fiquei de postar do plproxy, 
inclusive testes de estress em cima dele, mas como a curiosidade falou 
mais alto,resolvi passar para o Londiste. A intenção é a seguinte:</p>
<p>Pegar o básico do PLPROXY, Londiste e PGBouncer (próximo post).  
Depois de um how to em cima de cada um deles montar um ambiente com os 3
 e meter BALA!</p>
<p>As primeira impressões que eu tive do  do londiste foram as seguintes:</p>
<h3>Documentação:</h3>
<p>Se a documentação do PLPROXY não era das melhores a do Londiste 
xiiiiiiiiiiii, lascou tudo, sinceramente uma negação, e vi os mesmos 
comentários dos gringos também Muito mal documentado mesmo!!!</p>
<h3>Instalação:</h3>
<p>A instalação foi um tanto penosa, perdi algumas horinhas mesmo 
batendo cabeça e pra não cometer novamente os erros eu documentei, ou 
pelo menos acho que documentei hehehe. Para quem não é perseverante, é 
desistência na certa!!!! E mais uma vez vi gringo reclamar!</p>
<h3>Implementação:</h3>
<p>Colocar o londiste pra rodar e ver suas bases de dados replicando é 
muito, mas muito simples mesmo.  Chega a ser ridículo ( depois de passar
 pela instalação….), é estremamente simples e chega ser 
recompensador!!!!</p>
<p>Então que comece a temporada do Londiste!!!!</p>
<h1><strong>O que é replicação???</strong></h1>
<p>Bem, como esse post não é sobre replicação em si, e mais precisamente sobre o Londiste não vamos entrar em todo o mérito!!!</p>
<p>O objetivo de um mecanismo de replicação de dados é permitir a 
manutenção de de várias cópias idênticas de um mesmo dado em vários 
servidores de banco de dados (SGBD).</p>
<h1><strong>Para que serve a replicação???</strong></h1>
<h2>Principais benefícios da replicação de dados são:</h2>
<p>Redundância.<br>
Possibilidade de um balanceamento de carga.<br>
Tornar o sistema menos sensível as falhas.</p>
<p>Sugiro que você jovem de uma lidinha sobre replicação ok?? hehhe eu quero é postar sobre o londiste!!!!</p>
<h1>É Pra que serve o Londiste??</h1>
<p>O Londiste é uma ferramenta para replicação assíncrona, 
master-to-slaves. Assíncrona significa que: Quando o nó master receber 
uma transação, existe um tempo para essa transação ser replicada nos nós
 slaves. O contrário disso , a replicação síncrona, ocorre quando as 
transações ocorrem em todos os nós on-line.</p>
<h1><strong>E como eu poderia usar o Londiste??</strong></h1>
<p>Hum deixa eu ver…. Onde não fosse necessário o espelhamento dos dados
 em todos os nós ao mesmo tempo??  Isso depende muito do projeto em 
questão. As vezes tenho somente 2 servidores de banco de dados, um 
servidor MASTER que recebe todas as transações e um servidorzinho na 
senzala, SLAVE que fica lá jogado esperando por receber os dados, depois
 que o Master fez uso …. As vezes tenho um servidor master e vários 
servidores slaves….. Então necessitou de dados repetidos em vários 
servidores, REPLICAÇÂO. Se não possui como pré-requisito que os dados 
sejam replicados instataneamente ,ASSÍNCRONO.<br>
Nunca se esquecer que eu tenho somente um MASTER e vários SLAVES. Tudo 
que acontece, o Master é quem manda… já viu escravo mandar no mestre??</p>
<h1><strong>AAAAA mas o Slony faz isso não????</strong></h1>
<p>Faz sim , slony faz até mais  por permitir cascateamento entre os nós
 e slave promotion. Ou seja no slony você tem um nó MASTER e outros nós 
slaves, mas esses nós slaves podem ser Providers para outros nós, 
cascateando assim os servidores.</p>
<p><strong><br>
</strong></p>
<h1><strong>Mas se o Slony tem mais recursos por que eu utilizaria o Londiste??</strong></h1>
<p>O londiste é muito mais simples de configurar e gerenciar, muito 
mesmo!!!! Antes o projeto Skype utilizava o próprio Slony, depois 
começaram a utilizar o Londiste, que foi desenvolvido por eles mesmos.<br>
Motivos!!!! Como já disse, facilidade de configurar e principalmente gerenciar.</p>
<p>Não tá acreditando né? Então toma!!!<br>
Trecho de uma discursão sobre Slony X londiste<br>
….<br>
“I have not been running slony for quite a long time. I last used it at<br>
Skype a few years ago before we moved to our own implementation -<br>
Londiste/pgQ from SkyTools. The main reason was that our cluster got too<br>
big to manage with slony. “<br>
….</p>
<h1><strong>Beleza então vamos começar a instalação!!!!</strong></h1>
<p>Como eu disse no início do post, o grande problema do Londiste, como 
todos to Skytools é a documentação. Eu estou utilizando o debian 4.0.</p>
<p>Depois de bater muito a cabeça acabei instalando alguns pacotes a mais:</p>
<p><em><strong>apt-get install build-essential python-psycopg libevent-dev  python-all-dev python-all python-support</strong></em></p>
<p>Uma vez instalados esses pacotes, vamos baixar o código fonte:<br>
<em><strong>http://pgfoundry.org/frs/download.php/1813/skytools-2.1.7.tar.gz</strong></em></p>
<p>baixado o código fonte no meu diretório /usr/src:<br>
<em><strong>tar -xzvf skytools-2.1.7.tar.gz</strong></em><br>
<em><strong><br>
./configure –with-pgconfigdir=/usr/local/pgsql/bin </strong> </em>(No meu caso ok?? deve-se setar o diretório do seu pg_config)<br>
<strong><br>
<em>make &amp;&amp; make install</em></strong><em></em></p>
<p>Se o bicho não reclamou de nada beleza!!! Se reclamou aí vamos ter que sambar um pouco….<br>
Pelo o que eu me lembre esses foram os pacotes que eu instalei, eu instalarei do zero novamente pra fazer a prova dos 9 <img src="postgresql_ha_arquivos/icon_smile.gif" alt=":)" class="wp-smiley"> </p>
<p>PS: O jovenzinho, ele sabe quem é…. vai falar, já tem o pacote no debian http://packages.debian.org/sid/skytools<br>
Olha o garotinho aí né ??? mas  não ta na versão stable ainda …. Detalhe: ele mantém o pacote <img src="postgresql_ha_arquivos/icon_smile.gif" alt=":)" class="wp-smiley"> </p>
<h1><strong>Criando o Ambiente!!!</strong></h1>
<p>Vamos fazer o seguinte: Iremos criar inicialmente 2 databases, um master e outro slave</p>
<p>create database mestre;<br>
create database escravo;</p>
<p>Em cada database iremos criar 2 tabelas:<br>
<em><strong>create table tabela1(id serial primary key,nome text);<br>
create table tabela2(id serial primary key,nome text);</strong></em></p>
<p>Um detalhe muito importante!!!!! Todas as tabelas devem ter <em><strong>chaves primárias ok</strong></em>??? Não se esqueça disso. Atenção nisso jovem!</p>
<p>O que vai acontecer: Nós iremos realizar algumas operações no banco 
de dados mestre e elas vão ser replicadas ao banco de dados escravo.</p>
<h1><strong>Criando o primeiro CLUSTER</strong></h1>
<p>Como eu disse a configuração do londiste é muito simples mesmo. Vamos lá:</p>
<h3>Crie um arquivo chamado <strong>replicacao.conf </strong>com o seguinte conteudo:</h3>
<p>[londiste]<br>
job_name = replic</p>
<p>provider_db = dbname=mestre host=localhost user=postgres<br>
subscriber_db = dbname=escravo host=localhost user=postgres</p>
<p>pgq_queue_name = londiste_replic</p>
<p>pidfile = /tmp/pid.%(job_name)s<br>
logfile = /tmp/log.%(job_name)s</p>
<p>loop_delay = 1</p>
<p>connection_lifetime = 30</p>
<h3>Crie um arquivo chamado ticker.ini com o seguinte conteúdo:</h3>
<p>[pgqadm]</p>
<p>job_name = ticker</p>
<p>db = dbname=mestre user=postgres host=localhost</p>
<p>maint_delay_min = 1</p>
<p>loop_delay = 0.5</p>
<p>logfile = /tmp/log.%(job_name)s<br>
pidfile = /tmp/pid.%(job_name)s</p>
<p>use_skylog = 0</p>
<p>connection_lifetime = 21</p>
<p>queue_refresh_period = 10</p>
<h1>Instalando o Londiste no sevidor mestre</h1>
<p>Devemos instalar toda a estrutura para o londiste rodar: A instalação
 deve ser feita tanto no servidor mestre como no servidor escravo. Essa 
estrutura consiste em instalar a linguagem plpgsql,plpython…</p>
<p><em><strong>londiste.py replicacao.conf  provider install</strong></em></p>
<p>Detalhe: <strong>provider</strong><em> o nó que é origem da replicação!</em></p>
<h1>Instalando o Londiste no servidor escravo</h1>
<p>&lt;Em cada um dos nós escravos devemos também instalar toda a estrutura necessária como descrito acima.<br>
<strong><br>
<em>londiste.py replicacao.conf subscriber install</em></strong></p>
<p>Detalhe: <strong>subscriber é </strong>o nó escravo!</p>
<h1>Colocando  o PGQ pra rodar…</h1>
<p>O Daemon pgqadm deve rodar no servidor master , ele vai ser o cara 
responsável pelo mecanismo de transporte para implementar a replicação!</p>
<p><em><strong>pgqadm.py -d ticker.ini ticker</strong></em><br>
para verificar se realmente esta rodando o processo vamos dar um ps aux | grep pgq</p>
<p>…..<br>
root     28190  0.0  0.2  19248  4780 ?        Ssl  14:20   0:00 /usr/bin/python /usr/local/bin/pgqadm.py -d ticker.ini ticker<br>
….</p>
<p>Olha que bicho danado hehehehe!!<br>
hummm… posso também dar um<strong> pgqadmin.py  -d ticker.ini  status</strong><em> ,</em> tenta aí jovem!</p>
<p>Então pra encher o saco e memorizar!!! rodar o daemon pgqadmin no 
master utilizando o parametro -d ( o -d e pra rodar como daemon) 
passando o arquivo de configuracao ticker.ini  e a opcao ticker.</p>
<p>Se eu quizer parar o daemon<em>:<strong> pgqadmin.py&nbsp; -s ticker.ini </strong></em><br>
Curioso? lista o processo novamente!<br>
Memorize os parâmetros e como exercício levante e suba umas 1000 vezes.</p>
<h1>Colocando o daemon de replicação no ar!</h1>
<p>Você precisa rodar o deamon de replicação em cada host, como no nosso
 caso o host provider e subscriber estão na mesma máquina vamos la!</p>
<p><em><strong>londiste.py -d replicao.ini replay</strong></em></p>
<p>ps  aux | egrep “lond|pgq”</p>
<p>root     28568  0.0  0.2  11332  4860 ?        Ss   14:59   0:00 
/usr/bin/python /usr/local/bin/londiste.py -d replicacao.ini replay<br>
root     28693  0.0  0.2  19244  4772 ?        Ssl  15:05   0:00 /usr/bin/python /usr/local/bin/pgqadm.py -d ticker.ini ticker<br>
root     28725  0.0  0.0   3020   816 pts/0    R+   15:06   0:00 egrep lon|pgq</p>
<p>Exatamente os caras que eu estava esperando o pgqadm ( que é o cara 
que fica no master e) o londiste.py ( que é o cara que roda em cada 
escravo)</p>
<h1>Escolhendo os objetos as serem replicados</h1>
<p>Seguindo o nosso roteiro ja temos os deamons rodando no nó provider e
 nos nós subscribers. Devemos informar ao Londiste quais tabelas e 
sequences devemos replicar.</p>
<p>No nosso exemplo iremos replicar 2 tabelas: tabela1 e tabela2.</p>
<p>No nó de origem devemos executar o seguinte comando:</p>
<p><em><strong>londiste.py&nbsp;&nbsp; replicacao.conf&nbsp; provider add&nbsp; tabela1</strong></em></p>
<p><em><strong>londiste.py&nbsp; replicacao.conf&nbsp; provider add tabela2</strong></em></p>
<p>Também temos que replicar as sequences criadas pelo campo serial!!!</p>
<p><em><strong>londiste.py replicacao.conf provider add-seq tabela1_id_seq;</strong></em></p>
<p><em><strong>londiste.py replicacao.conf provider add-seq tabela2_id_seq;</strong></em></p>
<p>Po mas nao apareceu mensagem nenhuma pra mim? Está tudo tão obscuro!!!</p>
<p>beleza&nbsp; jovem mancebo…. faz o seguinte</p>
<p><em><strong>londiste.py replicacao.conf provider tables</strong></em></p>
<p>public.tabela2<br>
public.tabela1</p>
<p><em><strong>londiste.py replicacao.conf provider seqs</strong></em></p>
<p>public.tabela2_id_seq<br>
public.tabela1_id_seq</p>
<p><em><strong><br>
</strong></em></p>
<p>Detalhe na palavra provider!!!</p>
<p>Agora o mesmo procedimento nos nós de origem!!</p>
<p><em><strong>londiste.py&nbsp;&nbsp; replicacao.conf&nbsp; subscriber add&nbsp; tabela1</strong></em></p>
<p><em><strong>londiste.py&nbsp; replicacao.conf&nbsp; subscriber add tabela2</strong></em></p>
<p><em><strong>londiste.py replicacao.conf&nbsp; subscriber add-seq tabela1_id_seq;</strong></em></p>
<p><em><strong>londiste.py replicacao.conf&nbsp; subscriber&nbsp; add-seq tabela2_id_seq;</strong></em></p>
<p>Para dar aquela conferida básica….</p>
<p><em><strong>londiste.py replicacao.conf&nbsp; subscriber tables</strong></em></p>
<p>public.tabela2<br>
public.tabela1</p>
<p><em><strong>londiste.py replicacao.conf subscriber seqs</strong></em></p>
<p>public.tabela2_id_seq<br>
public.tabela1_id_seq</p>
<p>Detalhe na palavra subscriber!!</p>
<h1>Enfim Replicando……UFA!</h1>
<p>Vamos testar agora se a replicação vai funfar ou não, o cabra le o 
artigo se irrita e quer logo ver a parada funcionar, pelo menos eu sou 
assim <img src="postgresql_ha_arquivos/icon_razz.gif" alt=":P" class="wp-smiley"> </p>
<p>Suponha que seu psql esteja no seu PATH e vc esteja usando linux <img src="postgresql_ha_arquivos/icon_smile.gif" alt=":)" class="wp-smiley"> . AAAAAAAAAAAAAAA beleza então insere na mão mesmo se preferir!! <img src="postgresql_ha_arquivos/icon_smile.gif" alt=":)" class="wp-smiley"> </p>
<p>for i in $(seq 1 10000) ; do psql -U postgres -h localhost -c “insert into tabela1 values(default,’joao$i’)” mestre ; done</p>
<p>Com isso inserimos 10000 registros na tabela1. Após&nbsp; a inserção dos registros!!</p>
<p>Conecte-se no banco mestre e rode um count(*) na tabela1</p>
<p>Conecte-se no banco de dados escravo e rode um count(*) na tabela2</p>
<p>psql&nbsp; -U postgres -h localhost -c “select count(*) from tabela1″ mestre</p>
<p>psql&nbsp; -U postgres -h localhost -c “select count(*) from tabela1″ escravo</p>
<h1>Consideração finais…</h1>
<p>Fica pra amanhã estou realmente cansado…. Eu prometo que faço e não vai demorar quase um ano!<br>
 <img src="postgresql_ha_arquivos/icon_smile.gif" alt=":)" class="wp-smiley"> </p>
			</div>

		<p class="category">Enviado em <a href="http://pt-br.wordpress.com/tag/postgresql/" title="Ver todos os posts em Postgresql" rel="category tag">Postgresql</a> |    <a href="http://joaocosme.wordpress.com/2009/04/01/comecando-com-o-londiste/#comments" title="Comentário para Começando com o&nbsp;Londiste…">5 Comentários »</a></p>
		</div>

	
		<div class="post-55 post type-post status-publish format-standard hentry category-geral" id="post-55">
			<h2><a href="http://joaocosme.wordpress.com/2009/03/20/tiesto-feat-julie-thompson-do-you-feel-me-muito-bom-mesmo-trampando-e-escutando-um-som-louco-desses/" rel="bookmark" title="Permanent link to Tiesto feat. Julie Thompson – Do You Feel&nbsp;Me">Tiesto feat. Julie Thompson – Do You Feel&nbsp;Me</a></h2>
			<p class="date">Posted by joaocosme em março 20, 2009</p>
			<div class="entry">
				<div class="lyrictext" style="text-align: center;">
<div class="lyrictext">As darkness comes you sleep alone<br>
I watch the world I’ve always known<br>
Turning the corners of your mind<br>
And I look, focus on your smile</div>
<p>Oh the summer breeze<br>
Somehow singing softly into you<br>
Dadada dadada dadada<br>
Hear me whispering<br>
Always there, no matter what you do</p>
<p>I can’t stop falling when my heart comes calling<br>
Do you feel me?<br>
Warming you like rays of sunshine<br>
Can’t stop falling when my heart comes calling<br>
Do you feel me?<br>
Warming you like rays of golden light</p>
<p>(Summer Breeze)<br>
(Whispering)<br>
(Summer Breeze)<br>
(Whispering)</p>
<p>In shadows hide your deepest fears<br>
If only you knew I was here<br>
You’re safe and seldom need my daze<br>
You have the need to be afraid<br>
(I am here)</p>
<p>I can’t stop falling when my heart comes calling<br>
Do you feel me?<br>
Warming you like rays of sunshine<br>
Can’t stop falling when my heart comes calling<br>
Do you feel me?<br>
Warming you like rays of golden light</p>
<p>Oh the summer breeze<br>
Somehow singing softly into you<br>
Dadada dadada dadada<br>
Hear me whispering<br>
Always there, no matter what you do</p></div>
			</div>

		<p class="category">Enviado em <a href="http://pt-br.wordpress.com/tag/geral/" title="Ver todos os posts em geral" rel="category tag">geral</a> |    <a href="http://joaocosme.wordpress.com/2009/03/20/tiesto-feat-julie-thompson-do-you-feel-me-muito-bom-mesmo-trampando-e-escutando-um-som-louco-desses/#respond" title="Comentário para Tiesto feat. Julie Thompson – Do You Feel&nbsp;Me">Deixar um comentário » </a></p>
		</div>

			<div class="bottomnavigation">
			<div class="alignleft"><a href="http://joaocosme.wordpress.com/page/2/">« Entradas Anteriores</a></div>
			<div class="alignright"></div>
		</div>
	
	</div>

</div>
<div class="clearingdiv">&nbsp;</div>
</div>

<div id="footer">
<a href="http://pt-br.wordpress.com/?ref=footer" rel="generator">Blog no WordPress.com</a>. | Theme: <a href="http://theme.wordpress.com/themes/andreas09/">Andreas09</a> by <a href="http://andreasviklund.com/" rel="designer">Andreas Viklund</a>.</div>

<script type="text/javascript">
// <![CDATA[
(function() {
try{
  if ( window.external &&'msIsSiteMode' in window.external) {
    if (window.external.msIsSiteMode()) {
      var jl = document.createElement('script');
      jl.type='text/javascript';
      jl.async=true;
      jl.src='/wp-content/plugins/ie-sitemode/custom-jumplist.php';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jl, s);
    }
  }
}catch(e){}
})();
// ]]>
</script><script type="text/javascript">_qoptions={qacct:'p-18-mFEk4J448M',labels:'language.pt-br,type.wpcom'};</script>
<script type="text/javascript" src="postgresql_ha_arquivos/quant.js"></script>
<noscript><p><img class="robots-nocontent" src="http://pixel.quantserve.com/pixel/p-18-mFEk4J448M.gif?labels=language.pt-br%2Ctype.wpcom" style="display:none" height="1" width="1" alt="" /></p></noscript>
<script type="text/javascript" src="postgresql_ha_arquivos/gprofiles.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var WPGroHo = {
	my_hash: ""
};
/* ]]> */
</script>
<script type="text/javascript" src="postgresql_ha_arquivos/wpgroho.js"></script>
	<div style="display: none;">
	</div>
<script type="text/javascript" src="postgresql_ha_arquivos/beacon.js"></script><script type="text/javascript">try{COMSCORE.beacon({c1:2,c2:7518284});}catch(e){}</script><noscript><p class="robots-nocontent"><img src="http://b.scorecardresearch.com/p?cj=1c1=2&#038;c2=7518284" alt="" style="display:none" width="1" height="1" /></p></noscript><script src="postgresql_ha_arquivos/w.js" type="text/javascript"></script>
<script type="text/javascript">
st_go({'blog':'3961779','v':'wpcom','user_id':'0','post':'0','subd':'joaocosme'});
ex_go({'crypt':'UE40eW5QN0p8M2Y/RE1LVmwrVi5vQS5fVFtfdHBbPyw1VXIrU3hWLHhmQnBoc1dUQjB1cTdwY1BsWVtBMzcyN3RTa102N2VDRlY4LnFuLVh1U0cxSHNqaXhSMXkyT1RpaXQuWUUrdjcuUVBMSjlDcGRVdmZSRDFBdiVBME5CdSVoMGF+cHdGV04/Rl1qRVF1cG1wM2suU3pXQ1R0U05DJWImP3VMT0UlX3NIT2lnR3xROU5ZMmw='});
addLoadEvent(function(){linktracker_init('3961779',0);});
	</script><img id="wpstats" src="postgresql_ha_arquivos/g.gif" alt=""><img id="wpstats2" src="postgresql_ha_arquivos/g_002.gif" alt="" style="display: none;">

</body></html>