Alguem sabe como faço no postgres para pegar a quantidade de meses entre duas datas?
No oracle existia esta function, alguem sabe se no postgres existe algo parecido?

Ai vai uma solução.

select extract('month' from age('2008-05-05','2008-03-19'));
-----------
Existe alguma função no postgres para retornar um campo númerico como
texto com zeros a esquerda?

Por exemplo tenho uma tabela 'resultados' com um campo 'segunda' e
nesse campo segunda tem o valor 1 mas eu quero retornar sempre com 3
digitos '001'. Tem como fazer esse tratamento no próprio SELECT?
--
Rúben Lício Reis

SELECT to_char(1, '000');

Osvaldo

select lpad(1,3,0);

http://www.postgresql.org/docs/8.3/interactive/functions-string.html

---------------
Primeiro caso de um cliente da minha empresa apÃ³s 4 anos de uso do meu sistema.
16 mb dÃ¡ o banco de dados quando compactado.
14 mÃ¡quinas acessando o banco.
servidor Ã© um pentium IV com 512 de memÃ³ria.
todos os micros possuem XP mas os demais da rede, alguns sÃ£o bons, e a metade Ã© o celeron 315 com 256 ou 512 de memÃ³ria.
O postgre, ligando os micros de manha e fazendo um reindex e vacuum, funciona blz, atÃ© perto do meio dia quando parece que arquivos ficam presos na rede e o sistema fica lento, uma operaÃ§Ã£o de localizar um produto que deveria ser imediato, leva 2 minutos, Ã© algo absurdo, sÃ³ desligando todas as mÃ¡quinas ligando tudo de novo e fazendo a manutenÃ§Ã£o para restaurar, o que pode ser?
grato,
erlon

Vamos comerÃ§ar pelo bÃ¡sico, ok?

0. Qual Ã© a versÃ£o do PostgreSQL instalada?
1. Qual Ã© o sistema operacional do servidor?
2. Quais serviÃ§os rodam junto com ele?
3. VocÃª fez algum tipo de tunning?
4. Qual Ã© o tipo de conexÃ£o que a tua aplicaÃ§Ã£o utiliza?
5. A tua aplicaÃ§Ã£o esta instalada no cliente ou no servidor?
6. VocÃª verificou se, no servidor, algum processo toma todos os
recursos da mÃ¡quina quando a conexÃ£o com o banco fica lenta? Qual Ã©
ele?

AbraÃ§o!

--
Atenciosamente,
Sebastian Selau Webber Colombo
--
Podem ser muitas coisas...

1) Rede esta tudo ok? Sua topologia de rede garante um acesso de alto
throughput? NÃ£ hÃ¡ colisÃ£o?

2) As estaÃ§Ãµes clientes estÃ£o protegidas contra vÃ­rus? NÃ£o estÃ£o rodando
softwares paralelos fora do escopo de trabalho dos usuarios?

3) O seu sistema nÃ£o sofreu alguma alteraÃ§Ã£o?

4) O servidor foi configurado para um melhor desempenho?

5) Como estÃ£o os indicadores de desempenho do servidor? Memoria, Cpu e
UtilizaÃ§Ã£o do Disco?

6) Seus discos sÃ£o rÃ¡pidos o suficiente para sua aplicaÃ§Ã£o?

7) Habilite os logs de consultas lentas no postgresql.conf e verifique
se nÃ£o hÃ¡ consultas 'gulosas' em seu sistema.

8) Existem uma serie de outros itens mas esses jÃ¡ sÃ£o um comeÃ§o...

--
[]s
Dickson S. Guedes
-----------
Swap para o PG

> A pergunta Ã© pertinente pois quem me antecedeu na empresa preparou um
> servidor com SUSE+ ORACLE 10 e o Swap dessa mÃ¡quina tem 2 Gb.

O Oracle Ã© muito mais gordo e exige determinados tamanhos de arquivo
ou partiÃ§Ã£o de troca atÃ© para instalar.

Mas a idÃ©ia em bases de dados Ã© usar a troca de pÃ¡ginas o mÃ­nimo possÃ­vel.
Leandro

--------------
Instalando o PostgreSQL-8.2 no Debian 4:

>  JÃ¡ tentei, mas nÃ£o tem essa versÃ£o no repositÃ³rio, aÃ­ Ã© so na unha mesmo...

Utilize backport:

apt-get install postgresql-8.2 -t etch-backports

Leonardo Cezar et all
------------
Acentos em PG 8.3 em Windows

josemario rosa	
	
select * from agenda  WHERE to_ascii(nome, 'latin1') ilike 'JO%'
 
e eu estou usando o win1252 

------------------
Estou precisando fazer um union mas sao de tabelas parecidas, sendo assim alguns campos nÃ£o existem em outras.
No mysql colocava <campo> is null e passava. Como faÃ§o no postgres?
Valter Cezar Prado Junior

VocÃª pode fazer da mesma forma:

SELECT campo1,campo2,campo3 FROM tabela1 UNION SELECT campo1,campo2,null FROM tabela2;

NÃ£o esqueÃ§a que o union ingora valores repetidos, se quiser repetir os valores tem que usar UNION ALL.
Jota
--
A soluÃ§Ã£o apresentada pelos colegas Ã© corretam mas vale lembrar que
Se na primeira tabela que vc usar o select, nÃ£o houver algum dos campos que
estÃ£o nas outras tabelas, use um alias para o NULL:

Ex.

Tabela 1
campo1, campo2, campo3

Tabela 2
campo1, campo2, campo4

O SQL fica assim

SELECT campo1, campo2, campo3, NULL as campo4
UNION
SELECT campo1, campo2, NULL, campo4;

Dessa forma o retorno jÃ¡ vem com os campos devidamente nomeados

-----------
Tabela 1
campo1, campo2, campo3

Tabela 2
campo1, campo2, campo4

O SQL fica assim

SELECT t1.campo1, t1.campo2, t1.campo3, NULL as t1.campo4 from Tabela1 t1
UNION
SELECT t2.campo1, t2.campo2, NULL as t2.campo3, t2.campo4 from Tabela2 t2;

Renato

--------------
Objetos grandes no banco

jota. comm para Comunidade
	
mostrar detalhes 21:47 (9 horas atrás)
	
	
Responder
	
	
Opa,

Vamos lá:

É importante você saber que na verdade sua imagem não é armazenada na tabela que você está especificando, nesta sua tabela é apenas criado um OID que faz referência a tabela pg_largeobject que é onde verdadeiramente está armazenada a sua imagem.

Para conseguir retornar a imagem em um select, você tem que especificar a imagem de retorno, por exemplo:

select lo_export(oid_imagem,'/caminho/da/imagem.jpg')
from minha_tabela
where nome_imagem='minha_imagem');

Caso você venha a fazer um delete da imagem, você tem que ter o seguinte cuidado:
Se você deletar apenas a imagem da sua tabela, o objeto não será apagado, pois ele está armazenado na tabela pg_largeobject, então você precisa remover de lá também.

Para deletar da pg_largeobject
select lo_unlink(oid_imagem);
ou
select lo_unlink(oid_imagem)
from minha_tabela where minha_imagem='imagem';

Apagando da sua tabela:
delete from minha_tabela where minha_imagem='imagem';

Espero ter ajudado.

[]s

2008/5/7 Raphael Teixeira de Carvalho Matos <raphaelstinfler@gmail.com>:



    2008/5/7 Marcos Fabrício Corso <marcoscorso@terra.com.br>:

        olá pessoal]
        alguém trabalha com php e postgres, inserindo figuras no banco de dados ?
        tô precisando de uma ajuda com isso ...
         
        ainda estou testando local, por isso o c:
        para inserir no banco eu uso :
        update escol215 set figura = lo_import ('c:/site/images/p2q6t4.jpg') where codigo = 2 and questao = 6 and tipo = 4 ;


    Correto
     

        e para selecionar e mostrar a figura estou usando
        select lo_export('c:/site/images/p2q6t4.jpg') from escol215 where codigo = 2 and questao = 6 and tipo = 4 ;
         
        está correto ?
        na parte de inserir/fazer update está funcionando ...
        e para selecionar, não estou conseguindo, como fazer ??


    Você tem q especificar o nome do campo antes de dar o caminho e o nome da imagem .. por exemplo   , pelo que eu vi o campo em que você armazena as fotos é figura então ficaria da seguinte maneira :
    select lo_export( figura , 'c:/site/images/p2q6t4.jpg') from escol215 where codigo = 2 and questao = 6 and tipo = 4 ;
     

        e depois que eu mudar para meu servidor, para o site, tenho que tirar o c:, como deve ficar o caminho ?

------
Convertendo MDB (Access) para PostgreSQL

1) Instale o mdb-tools
sudo aptitude install mdb-tools

2) Rode o seguinte comando:
mdb-schema arquivo.MDB | sed -e "s/Long//" | sed -e "s/Text/Varchar/" | sed -e "s/DateTime/Timestamp/" | sed -e "s/Short/0/" > esquema.sql
Pode ser necessário acrescentar outros SED neste comando se o MDB tiver algum outro tipo de dado não suportado.

3) Execute o script em anexo no arquivo MDB redirecionando para um arquivo.
./dump-mdb.sh arquivo.MDB > dados.sql

4) Pronto! O arquivo "esquema.sql" conterá o esquema e o arquivo "dados.sql" conterá os dados.
Alexsander Rosa
----------
"Luciano Mittmann" <mittmann@gmail.com> escreveu:

> Olá a todos,
>
> Recentemente, aqui na CELEPAR, andaram me perguntado(sondando) sobre
> alta disponibilidade, balanceamento de carga e replicação síncrona no
> postgres utilizando as ferramentas citadas no assunto desta mensagem.
> Confesso que ainda não tive o prazer de testá-las mas já lí uma parte
> da documentação e alguns howtos e fiquei bem curioso em ver a solução
> "como um todo" em funcionamento. Gostaria de saber se alguém da lista
> já botou o trio pra funcionar e queira compartilhar os resultados.

 Sim, funciona bem, muito bem. O mais chato até entender é o PL/Proxy,
o resto é de boa.


 Eles estão já empacotados para o Debian[1][2][3] mas o pgbouncer está
com bugs bobos[4] que corrigi mas ainda não foram para o repositório
do Debian[5]. :(



Referências:

1 - http://packages.debian.org/sid/skytools
2 - http://packages.debian.org/plproxy
3 - http://packages.debian.org/pgbouncer
4 - http://bugs.debian.org/pgbouncer
5 - http://www.midstorm.org/~fike/debian

--
Fernando Ike
http://www.midstorm.org/~fike/weblog
-------------
restauracao de desastre de banco

Fala galera, blz?

Eu estou fazendo alguns testes em meu ambiente, pois caso tenha problemas com um servidor, possa voltar ele
desde o ultimo backup.
Para realizar o backup , eu fiz um backup físico do banco de dados utilizando as funcoes pg_start_backup e
pg_stop_backup. Copiei todos os diretorios de dados do banco, com excessao da pasta pg_xlog, pois queria ver
como iria se comportar o banco na volta.

Restaurei o banco em um outro servidor de testes, e quando fui iniciar o banco de dados, ele acusou que estava
precisando de um arquivo que estava dentro da pasta pg_xlog. Ao verificar este arquivo, eu percebi que o
horário em que ele foi criado era muito depois do horário do backup, e não consegui subir sem que fosse feita a
cópia pra ele. Depois que fiz isso, o banco subiu normalmente.

Mas eu fiquei com uma dúvida:

E se no meu backup, como tenho em outra particão, acontece algo e perco a pasta pg_xlog?

Tem algum comando que eu posso executar para que quando ele subir o banco, ignore os arquivos que poderiam
conter no pg_xlog?

Junior
----------
jota. comm 
Olá,

Se você quer restaurar a partir do último backup você pode usar o pg_dump e um psql (se for dump binário pg_restore) para restaurar os seus dados. Ou você não pode fazer isso? Agora caso queira recuperar informações posteriores ao último backup, ai você necessita do mecanismo de PITR, que é um mecenismo baseado nos logs de transação.

Você está usando o mecanismo de PITR ou apenas resolveu fazer um backup físico e tentou restaurar no servidor de testes?

Abraços
--------------

Desempenho

O que ilustra dois pontos interessantes sobre desempenho: bases de
dados sÃ£o limitadas por E/S, nÃ£o CPU; e de nada adianta muita memÃ³ria
se nÃ£o se configura o seu uso pelo SGBD.
Leandro


Consulta que ignora acentos

local=# SELECT nome from pessoa where to_ascii(nome) ilike '%jose%';
        nome
---------------------
 Antonia Josefina
 JosÃ© Silveira
 JosÃ© da Silva Sauro

Para bancos em UTF8 use:
SELECT nome from clientes where to_ascii(nome,'LATIN1') ilike '%fla%';
Mostra FÃ¡vio.

Marco AurÃ©lio C Feitosa

convert('text_in_utf8', 'UTF8', 'LATIN1')
convert_from('text_in_utf8', 'UTF8')
convert_to('some text', 'UTF8')
md5('abc')
strpos('high', 'ig') -- 2

---------------
 Corrigindo Estouro do MÃ¡ximo de transaÃ§Ãµes (2 bilhÃµes)
Constatando:
SELECT datname, age(datfrozenxid) FROM pg_database;
age acusa mais de 2 bilhÃµes
Tarcizio Meurer
- Execute um dumpall na base
- drop a base e o agrupamento de dados
- recrie o agrupamento
- recrie a base
- carrege os dados novemente.

--------------------
FunÃ§Ã£o que Remove Acentos

PrevenÃ§Ã£o de falhas devido ao reinÃ­cio do ID de transaÃ§Ã£o
SELECT datname, age(datfrozenxid) FROM pg_database;


CREATE OR REPLACE FUNCTION sem_acento(text) RETURNS text AS $$
    SELECT translate($1,
            'Ã¡Ã Ã¢Ã£Ã¤Ã©Ã¨ÃªÃ«Ã­Ã¬Ã¯Ã³Ã²Ã´ÃµÃ¶ÃºÃ¹Ã»Ã¼ÃÃÃÃÃÃÃÃÃÃÃÃÃÃÃÃÃÃÃÃÃÃ§Ã',
            'aaaaaeeeeiiiooooouuuuAAAAAEEEEIIIOOOOOUUUUcC');
$$ LANGUAGE SQL  IMMUTABLE  RETURNS NULL ON NULL INPUT;

Repare que nÃ£o estÃ£o contemplados todos os caracteres acentuados
(creio que os do portuguÃªs estÃ£o), mas, aÃ­, Ã© sÃ³ uma questÃ£o de
complementar as listas acima (caracteres acentuados e os
correspondentes nÃ£o acentuados).

Dependendo do conteudo de seu banco de dados pode ser que vocÃª
necessite tratar, por ex. o n com til, s com cedilha, os com caron (um
circunflexo invertido), os com barra etc.

Se vocÃª utilizar Ã¡rabe, hangul ou chinÃªs (entre outros) nÃ£o tenho a
menor idÃ©ia do comportamento esperado para esta funÃ§Ã£o.

Osvaldo
