<html><head>

<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"><title>DBMS_PIPE Comprehensive Example</title>

<meta name="keywords" content="dbms_pipe, dbms_pipe example, oracle compatibility, oracle, developers, developer's guide, enterprisedb, postgres plus advanced server, postgres plus">
<meta name="GENERATOR" content="HTML Transit 8.0 Trial Version by Avantstar, Inc. www.avantstar.com">
<meta name="TransitPubID" content="2158"><style type="text/css">
<!--
	.Title-1
	{
		text-align: center
	}
	.Heading1-1
	{
		text-align: left
	}
-->
</style></head><body><a name="TopOfPage"> </a>
<!-- TRANSIT - INFOBEFORE -->
<a href="http://www.enterprisedb.com/index.do?lpage=true"><img alt="EnterpriseDB" src="EnterpriseDB_OraCompat_EN_8.3-221_arquivos/logo.gif" border="0"></a><p style="text-align: center;"><a href="http://www.enterprisedb.com/docs/en/8.3/oracompat/EnterpriseDB_OraCompat_EN_8.3-220.htm#TopOfPage"><img src="EnterpriseDB_OraCompat_EN_8.3-221_arquivos/inveppv.gif" alt="Previous Page" border="0"></a><!-- TRANSIT - TOC --><a href="http://www.enterprisedb.com/docs/en/8.3/oracompat/Table%20of%20Contents.htm#TopOfPage" target="_top"><img src="EnterpriseDB_OraCompat_EN_8.3-221_arquivos/invetoc.gif" alt="Table Of Contents" border="0"></a><a href="http://www.enterprisedb.com/docs/en/8.3/oracompat/EnterpriseDB_OraCompat_EN_8.3-222.htm#TopOfPage"><img src="EnterpriseDB_OraCompat_EN_8.3-221_arquivos/invepnx.gif" alt="Next Page" border="0"></a></p>

  <div style="margin-left: 36pt;"><p><a name="P10830_570641"></a><span style="font-family: 'Arial'; font-size: 13pt;">7.3.11 Comprehensive Example</span></p>

</div><p><span style="font-family: 'Times New Roman'; font-size: 12pt; color: Black;">The
following example uses a pipe as a &#8220;mailbox&#8221;. The procedures to create
the mailbox, add a multi-item message to the mailbox (up to three
items), and display the full contents of the mailbox are enclosed in a
package named, </span><span style="font-family: 'Courier New'; font-size: 11pt; color: Black;">mailbox</span><span style="font-family: 'Times New Roman'; font-size: 12pt; color: Black;">.</span></p><div style="margin-left: 12pt;"><pre><span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">CREATE OR REPLACE PACKAGE mailbox</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">IS</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">    PROCEDURE create_mailbox;</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">    PROCEDURE add_message (</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        p_mailbox   VARCHAR2,</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        p_item_1    VARCHAR2,</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        p_item_2    VARCHAR2 DEFAULT 'END',</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        p_item_3    VARCHAR2 DEFAULT 'END'</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">    );</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">    PROCEDURE empty_mailbox (</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        p_mailbox   VARCHAR2,</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        p_waittime  INTEGER DEFAULT 10</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">    );</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">END mailbox;</span>

<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">CREATE OR REPLACE PACKAGE BODY mailbox</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">IS</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">    PROCEDURE create_mailbox</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">    IS</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        v_mailbox   VARCHAR2(30);</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        v_status    INTEGER;</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">    BEGIN</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        v_mailbox := DBMS_PIPE.UNIQUE_SESSION_NAME;</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        v_status := DBMS_PIPE.CREATE_PIPE(v_mailbox,1000,FALSE);</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        IF v_status = 0 THEN</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">            DBMS_OUTPUT.PUT_LINE('Created mailbox: ' || v_mailbox);</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        ELSE</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">            DBMS_OUTPUT.PUT_LINE('CREATE_PIPE failed - status: ' ||</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">                v_status);</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        END IF;</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">    END create_mailbox;</span>

<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">    PROCEDURE add_message (</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        p_mailbox   VARCHAR2,</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        p_item_1    VARCHAR2,</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        p_item_2    VARCHAR2 DEFAULT 'END',</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        p_item_3    VARCHAR2 DEFAULT 'END'</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">    )</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">    IS</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        v_item_cnt  INTEGER := 0;</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        v_status    INTEGER;</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">    BEGIN</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        DBMS_PIPE.PACK_MESSAGE(p_item_1);</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        v_item_cnt := 1;</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        IF p_item_2 != 'END' THEN</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">            DBMS_PIPE.PACK_MESSAGE(p_item_2);</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">            v_item_cnt := v_item_cnt + 1;</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        END IF;</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        IF p_item_3 != 'END' THEN</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">            DBMS_PIPE.PACK_MESSAGE(p_item_3);</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">            v_item_cnt := v_item_cnt + 1;</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        END IF;</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        v_status := DBMS_PIPE.SEND_MESSAGE(p_mailbox);</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        IF v_status = 0 THEN</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">            DBMS_OUTPUT.PUT_LINE('Added message with ' || v_item_cnt ||</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">                ' item(s) to mailbox ' || p_mailbox);</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        ELSE</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">            DBMS_OUTPUT.PUT_LINE('SEND_MESSAGE in add_message failed - ' ||</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">                'status: ' || v_status);</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        END IF;</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">    END add_message;</span>

<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">    PROCEDURE empty_mailbox (</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        p_mailbox   VARCHAR2,</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        p_waittime  INTEGER DEFAULT 10</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">    )</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">    IS</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        v_msgno     INTEGER DEFAULT 0;</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        v_itemno    INTEGER DEFAULT 0;</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        v_item      VARCHAR2(100);</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        v_status    INTEGER;</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">    BEGIN</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        v_status := DBMS_PIPE.RECEIVE_MESSAGE(p_mailbox,p_waittime);</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        WHILE v_status = 0 LOOP</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">            v_msgno := v_msgno + 1;</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">            DBMS_OUTPUT.PUT_LINE('****** Start message #' || v_msgno ||</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">                ' ******');</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">            BEGIN</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">                LOOP</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">                    v_status := DBMS_PIPE.NEXT_ITEM_TYPE;</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">                    EXIT WHEN v_status = 0;</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">                    DBMS_PIPE.UNPACK_MESSAGE(v_item);</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">                    v_itemno := v_itemno + 1;</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">                    DBMS_OUTPUT.PUT_LINE('Item #' || v_itemno || ': ' ||</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">                        v_item);</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">                END LOOP;</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">                DBMS_OUTPUT.PUT_LINE('******* End message #' || v_msgno ||</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">                    ' *******');</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">                DBMS_OUTPUT.PUT_LINE('*');</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">                v_itemno := 0;</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">                v_status := DBMS_PIPE.RECEIVE_MESSAGE(p_mailbox,1);</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">            END;</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        END LOOP;</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        DBMS_OUTPUT.PUT_LINE('Number of messages received: ' || v_msgno);</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        v_status := DBMS_PIPE.REMOVE_PIPE(p_mailbox);</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        IF v_status = 0 THEN</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">            DBMS_OUTPUT.PUT_LINE('Deleted mailbox ' || p_mailbox);</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        ELSE</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">            DBMS_OUTPUT.PUT_LINE('Could not delete mailbox - status: '</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">                || v_status);</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">        END IF;</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">    END empty_mailbox;</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">END mailbox;</span></pre>

</div><p><span style="font-family: 'Times New Roman'; font-size: 12pt; color: Black;">The following demonstrates the execution of the procedures in </span><span style="font-family: 'Courier New'; font-size: 11pt; color: Black;">mailbox</span><span style="font-family: 'Times New Roman'; font-size: 12pt; color: Black;">. The first procedure creates a public pipe using a name generated by the </span><span style="font-family: 'Courier New'; font-size: 11pt; color: Black;">UNIQUE_SESSION_NAME</span><span style="font-family: 'Times New Roman'; font-size: 12pt; color: Black;"> function.</span></p><div style="margin-left: 12pt;"><pre><span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">EXEC mailbox.create_mailbox;</span>

<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">Created mailbox: PG$PIPE$13$3940</span></pre>

</div><p><span style="font-family: 'Times New Roman'; font-size: 12pt; color: Black;">Using the mailbox name, any user in the same database with access to the </span><span style="font-family: 'Courier New'; font-size: 11pt; color: Black;">mailbox</span><span style="font-family: 'Times New Roman'; font-size: 12pt; color: Black;"> package and </span><span style="font-family: 'Courier New'; font-size: 11pt; color: Black;">DBMS_PIPE</span><span style="font-family: 'Times New Roman'; font-size: 12pt; color: Black;"> package can add messages:</span></p><div style="margin-left: 12pt;"><pre><span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">EXEC mailbox.add_message('PG$PIPE$13$3940','Hi, John','Can you attend a meeting at 3:00, today?','-- Mary');</span>

<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">Added message with 3 item(s) to mailbox PG$PIPE$13$3940</span>

<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">EXEC mailbox.add_message('PG$PIPE$13$3940','Don''t forget to submit your report','Thanks,','-- Joe');</span>

<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">Added message with 3 item(s) to mailbox PG$PIPE$13$3940</span></pre>

</div><p><span style="font-family: 'Times New Roman'; font-size: 12pt; color: Black;">Finally, the contents of the mailbox can be emptied:</span></p><div style="margin-left: 12pt;"><pre><span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">EXEC mailbox.empty_mailbox('PG$PIPE$13$3940');</span>

<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">****** Start message #1 ******</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">Item #1: Hi, John</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">Item #2: Can you attend a meeting at 3:00, today?</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">Item #3: -- Mary</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">******* End message #1 *******</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">*</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">****** Start message #2 ******</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">Item #1: Don't forget to submit your report</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">Item #2: Thanks,</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">Item #3: Joe</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">******* End message #2 *******</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">*</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">Number of messages received: 2</span>
<span style="font-family: 'Courier New'; font-size: 9pt; color: rgb(46, 49, 146);">Deleted mailbox PG$PIPE$13$3940</span></pre></div><p style="text-align: center;"><a href="http://www.enterprisedb.com/docs/en/8.3/oracompat/EnterpriseDB_OraCompat_EN_8.3-220.htm#TopOfPage"><img src="EnterpriseDB_OraCompat_EN_8.3-221_arquivos/inveppv.gif" alt="Previous Page" border="0"></a><!-- TRANSIT - TOC --><a href="http://www.enterprisedb.com/docs/en/8.3/oracompat/Table%20of%20Contents.htm#TopOfPage" target="_top"><img src="EnterpriseDB_OraCompat_EN_8.3-221_arquivos/invetoc.gif" alt="Table Of Contents" border="0"></a><a href="http://www.enterprisedb.com/docs/en/8.3/oracompat/EnterpriseDB_OraCompat_EN_8.3-222.htm#TopOfPage"><img src="EnterpriseDB_OraCompat_EN_8.3-221_arquivos/invepnx.gif" alt="Next Page" border="0"></a></p>

<a href="http://www.avantstar.com/"><img src="EnterpriseDB_OraCompat_EN_8.3-221_arquivos/transpwr.gif" alt="Powered by Transit"></a><!-- TRANSIT - INFOAFTER -->
<script type="text/javascript"> 
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www."); 
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E")); 
</script><script src="EnterpriseDB_OraCompat_EN_8.3-221_arquivos/ga.js" type="text/javascript"></script> 
<script type="text/javascript"> 
var pageTracker = _gat._getTracker("UA-4413916-2"); 
pageTracker._initData(); 
pageTracker._trackPageview(); 
</script> 
</body></html>